<!DOCTYPE html>
<html>
<head>
    <title>MathApp</title>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
        <link rel="stylesheet" href="/CSS/styles.css"/>
				<script src="http://static.opentok.com/v1.1/js/TB.min.js" ></script>
		<style>
		@font-face {
			font-family:"Merriweather";
			src:url("/font/merriweather/Merriweather-Light.ttf");
		}
		body {
			font-family:"Merriweather" !important;
		}
		#content {
            margin:0;
            padding:0;
            height:100%;
        }

        #bigHeader {
            width:125%;
        }

        h1, h2, h3, h4, h5, h6 {
			font-family:"Merriweather" !important;
		}

		input[type='text'] {
			font-family:"Merriweather";
		}
        .row {
            position: relative;
            top: 0;
            width: 100%;
            overflow: hidden;
        }

        #problem_text {
            text-align: center;
        }

        .draggable {
            padding: 0.5em;
            border: 1px solid #555555;
            border-radius: 5px;
            height:200px;
            min-height:150px;
            min-width:150px;
            background: #ffffff;
        }

        .draggable #minimize {
            font-weight:bold;
            font-size: 10pt;
            text-align: right;
            margin: -10px;
        }

		</style>
		<link rel="stylesheet" type="text/css" href="/foundation-5.0.3/css/foundation.css"/>

		<script src="/js/jquery.js"></script>
		<script src="/js/jquery-ui.js"></script>
		<script src="/socket.io/socket.io.js"></script>
    <script>

        $(function() {
					// OpenTok
					var session = TB.initSession("1sdemo00855f8290f8efa648d9347d718f7e06fd");
					var API_KEY = "44618111";
					
					session.addEventListener("sessionConnected", sessionConnectedHandler);
					session.addEventListener("streamCreated", streamCreatedHandler);
					
					function sessionConnectedHandler(event) {
						subscribeToStreams(event.streams);
						session.publish();
					}
					
					function subscribeToStreams(streams) {
						for(var i = 0; i < streams.length; i++) {
							var stream = streams[i];
							if(stream.connection.connectionId != session.connection.connectionId) {
								session.subscribe(stream);
							}
						}
					}
					
					function streamCreatedHandler(event) {
						subscribeToStreams(event.streams);
					}
					
					session.connect(API_KEY, "Amit Mizrahi");
					
					
					var socket = io.connect('http://'+document.domain+':3001/session/<%= sessionID %>')
            $("#problem_text").hide();
            $(".draggable").hide();

            $("#problem_text").fadeIn(500);
            $(".draggable").delay(500).fadeIn(500);
            $(".draggable").draggable();
            $(".draggable").resizable();
            $(".draggable").mouseover(function() {
                $(this).animate({
                 "border-color": "#494949",
                 "border-width": "0.2em"
                 }, 100);
            });
            $(".draggable").mouseleave(function() {
                $(this).animate({
                    "border-color": "#9D9D9D",
                    "border-width": "1px"
                }, 100);
				                    });

            $("#minimize").click(function() {
                $(this).parent().css({
                      'min-height': '0px',
                      'min-width': '0px',
                       'position': 'fixed'
                });

                $(this).parent().animate({
                    "height": "40px",
                    "bottom": "0px",
                    "background-color": "#9E9E9E"
                }, 500);

                $(this).parent().html("");
            });

            $("#msg").keypress(function(e) {
								if(e.keyCode == 13) {
									e.preventDefault();
									if($(this).val() != '') {
										var messageText = $(this).val();
										socket.emit('chatMessage', {"messageText": messageText, "sendingUser": 'Amit Mizrahi'});
									}
								}
							});
					    socket.on('chatMessage', function(data) {
							console.log('yippee!');
							//var msgEl = $("<ul class='messageText'>"+"<b>"+data['user']+"</b>"+data['messageText']+"</ul>");
							//$("#chat-msgs").append(msgEl);
						});

        });

    </script>
</head>
<body>
    <div id="content">
        <div class="row panel" id="bigHeader">
            <h3 id="problem_text"><%= problemText %></h3>
        </div>

        <div class="draggable ui-widget-content large-4 medium-4 small-4 columns">
            <p id="minimize">_</p>
            <p>Drag me around</p>
        </div>

            <div class="draggable ui-widget-content large-4 medium-4 small-4 columns" id="chat">
                <ul id="chat-msgs">
                </ul>
                <input type="text" id="msg"/>
            </div>
    </div>
</body>
</html>