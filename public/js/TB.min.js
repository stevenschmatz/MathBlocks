/*
  OpenTok JavaScript Library v2.0.16
 http://www.tokbox.com/

 Copyright (c) 2013 TokBox, Inc.

 Date: January 10 10:51:58 2014
  Common JS Helpers on OpenTok 0.1.0 4997fe2 master
 http://www.tokbox.com/

 Copyright (c) 2013 TokBox, Inc.

 Date: October 03 12:23:09 2013

*/
(function(g){g.OT||(g.OT={});OT.properties={version:"v2.0.16",build:"e64438b",debug:"false",websiteURL:"http://www.tokbox.com",cdnURL:"http://static.opentok.com",loggingURL:"http://hlg.tokbox.com/prod",apiURL:"http://anvil.opentok.com",messagingProtocol:"wss",messagingPort:443,supportSSL:"true",cdnURLSSL:"https://swww.tokbox.com",loggingURLSSL:"https://hlg.tokbox.com/prod",
apiURLSSL:"https://anvil.opentok.com"}})(window);
!function(g,b){var f=function(a){return document.getElementById(a)},a=g.OTHelpers;g.OTHelpers=f;f.noConflict=function(){f.noConflict=function(){return f};g.OTHelpers=a;return f};f.isEmpty=function(a){if(null===a||a===b)return!0;if(Array.isArray(a)||"string"===typeof a)return 0===a.length;for(var c in a)if(a.hasOwnProperty(c))return!1;return!0};f.isNone=function(a){return a===b||null===a};f.isObject=function(a){return a===Object(a)};f.isFunction=function(a){return"function"===typeof a};f.extend=function(){var a=
Array.prototype.slice.call(arguments),b=a.shift();a.forEach(function(a){for(var c in a)b[c]=a[c]});return b};f.defaults=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();a.forEach(function(a){for(var c in a)void 0===b[c]&&(b[c]=a[c])});return b};f.clone=function(a){return!f.isObject(a)?a:Array.isArray(a)?a.slice():f.extend({},a)};f.noop=function(){};f.supportsWebSockets=function(){return"WebSocket"in g};f.now=function(){var a=g.performance||{},b,c=a.now||a.mozNow||a.msNow||a.oNow||
a.webkitNow;return c?(c=c.bind(a),b=a.timing.navigationStart,function(){return b+c()}):function(){return(new Date).getTime()}}();f.browser=function(){var a=g.navigator.userAgent.toLowerCase(),b,c="Unknown";-1<a.indexOf("firefox")&&(c="Firefox");-1<a.indexOf("opera")?c="Opera":-1<a.indexOf("msie")?c="IE":-1<a.indexOf("chrome")&&(c="Chrome");if((b=g.navigator.vendor)&&-1<b.toLowerCase().indexOf("apple"))c="Safari";a=null;f.browser=function(){return c};return c};f.canDefineProperty=!0;try{Object.defineProperty({},
"x",{})}catch(d){f.canDefineProperty=!1}f.defineGetters=function(a,b,c){var d={};void 0===c&&(c=!1);for(var h in b)d[h]={get:b[h],enumerable:c};Object.defineProperties(a,d)};Object.create||(Object.create=function(a){function b(){}if(1<arguments.length)throw Error("Object.create implementation only accepts the first parameter.");b.prototype=a;return new b});f.setCookie=function(a,b){try{localStorage.setItem(a,b)}catch(c){var d=new Date;d.setTime(d.getTime()+31536E6);d="; expires="+d.toGMTString();
document.cookie=a+"="+b+d+"; path=/"}};f.getCookie=function(a){var b;try{return b=localStorage.getItem("opentok_client_id")}catch(c){for(var a=a+"=",d=document.cookie.split(";"),h=0;h<d.length;h++){for(var e=d[h];e.charAt(0)==" ";)e=e.substring(1,e.length);e.indexOf(a)===0&&(b=e.substring(a.length,e.length))}if(b)return b}return null};f.invert=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b};var c={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};
c.unescape=f.invert(c.escape);var e={escape:RegExp("["+Object.keys(c.escape).join("")+"]","g"),unescape:RegExp("("+Object.keys(c.unescape).join("|")+")","g")};["escape","unescape"].forEach(function(a){f[a]=function(d){return d===null||d===b?"":(""+d).replace(e[a],function(b){return c[a][b]})}});f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var h=/(.)^/,i={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},k=
/\\|'|\r|\n|\t|\u2028|\u2029/g;f.template=function(a,b,c){var d,c=f.defaults({},c,f.templateSettings),e=RegExp([(c.escape||h).source,(c.interpolate||h).source,(c.evaluate||h).source].join("|")+"|$","g"),g=0,q="__p+='";a.replace(e,function(b,c,d,h,e){q=q+a.slice(g,e).replace(k,function(a){return"\\"+i[a]});c&&(q=q+("'+\n((__t=("+c+"))==null?'':OTHelpers.escape(__t))+\n'"));d&&(q=q+("'+\n((__t=("+d+"))==null?'':__t)+\n'"));h&&(q=q+("';\n"+h+"\n__p+='"));g=e+b.length;return b});q=q+"';\n";c.variable||
(q="with(obj||{}){\n"+q+"}\n");q="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+q+"return __p;\n";try{d=new Function(c.variable||"obj",q)}catch(o){o.source=q;throw o;}if(b)return d(b);b=function(a){return d.call(this,a)};b.source="function("+(c.variable||"obj")+"){\n"+q+"}";return b}}(window);
(function(g,b){b.statable=function(f,a,d,c,e){var h,i=d;f.is=function(){return-1!==Array.prototype.indexOf.call(arguments,i)};f.isNot=function(){return-1===Array.prototype.indexOf.call(arguments,i)};Object.defineProperties(f,{state:{get:function(){return i}},previousState:{get:function(){return h}}});return function(d){i!==d&&(-1===a.indexOf(d)?e&&b.isFunction(e)&&e("invalidState",d):(h=i,i=d,c&&b.isFunction(c)&&c(d,h)))}}})(window,window.OTHelpers);
(function(g,b){function f(a,b){var c=b||0,d=j;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function a(a,c,b){b=c&&b||0;"string"==typeof a&&(c="binary"==a?new k(16):null,a=null);a=a||{};a=a.random||(a.rng||i)();a[6]=a[6]&15|64;a[8]=a[8]&63|128;if(c)for(var d=0;16>d;d++)c[b+d]=a[d];return c||f(a)}var d,c,e=Array(16);d=function(){for(var a,c=0,c=0;16>c;c++)0===(c&
3)&&(a=4294967296*Math.random()),e[c]=a>>>((c&3)<<3)&255;return e};if(g.crypto&&crypto.getRandomValues){var h=new Uint32Array(4);c=function(){crypto.getRandomValues(h);for(var a=0;16>a;a++)e[a]=h[a>>2]>>>8*(a&3)&255;return e}}for(var i=c||d,k="function"==typeof Buffer?Buffer:Array,j=[],l={},m=0;256>m;m++)j[m]=(m+256).toString(16).substr(1),l[j[m]]=m;a.v4=a;a.parse=function(a,c,b){var d=c&&b||0,h=0,c=c||[];for(a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>h&&(c[d+h++]=l[a])});16>h;)c[d+h++]=
0;return c};a.unparse=f;a.BufferClass=k;a.mathRNG=d;a.whatwgRNG=c;b.uuid=a})(window,window.OTHelpers);
(function(g,b){function f(a){Object.defineProperty(a.prototype,"firstElementChild",{get:function(){var a;for(a=this.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return a}});Object.defineProperty(a.prototype,"lastElementChild",{get:function(){var a;for(a=this.lastChild;a&&1!=a.nodeType;)a=a.previousSibling;return a}});Object.defineProperty(a.prototype,"nextElementSibling",{get:function(){for(var a=this;!b.isNone(a=a.nextSibling)&&1!=a.nodeType;);return a}});Object.defineProperty(a.prototype,"previousElementSibling",
{get:function(){for(var a=this;!b.isNone(a=a.previousSibling)&&1!=a.nodeType;);return a}})}b.parseXML=function(a){var b;g.DOMParser?b=(new DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a),f(b));a=b.documentElement;return!a||!a.nodeName||"parsererror"===a.nodeName?null:b}})(window,window.OTHelpers);
(function(g,b){b.useLogHelpers=function(b){function a(a,c,k){return function(){if(b.shouldLog(c)){var j=g.console;if(j&&j[a])if(j[a].apply||Function.prototype.bind)j[a].apply||(j[a]=Function.prototype.bind.call(j[a],j)),j[a].apply(j,arguments);else j[a](Array.prototype.slice.apply(arguments).join(" "));else k&&k.apply(b,arguments);if(j=arguments){var l;try{l=JSON.stringify(j)}catch(m){l=j.toString()}2>=l.length||e.push([a,d(),l])}}}}function d(){var a=new Date;return a.toLocaleTimeString()+a.getMilliseconds()}
b.DEBUG=5;b.LOG=4;b.INFO=3;b.WARN=2;b.ERROR=1;b.NONE=0;var c=b.NONE,e=[];b.log=a("log",b.LOG);b.debug=a("debug",b.DEBUG,b.log);b.info=a("info",b.INFO,b.log);b.warn=a("warn",b.WARN,b.log);b.error=a("error",b.ERROR,b.log);b.setLogLevel=function(a){c="number"===typeof a?a:0;b.debug("TB.setLogLevel("+c+")");return c};b.getLogs=function(){return e};b.shouldLog=function(a){return c>=a}};b.useLogHelpers(b);b.setLogLevel(b.ERROR)})(window,window.OTHelpers);
(function(g,b,f){b.castToBoolean=function(a,b){return a===f?b:"true"===a||!0===a};b.roundFloat=function(a,b){return parseInt(Math.round(a*Math.pow(10,b)),10)/Math.pow(10,b)}})(window,window.OTHelpers);
(function(g,b){var f=[],a="OTHelpers."+b.uuid.v4()+".zero-timeout";g.addEventListener("message",function(b){b.source==g&&b.data==a&&(b.stopPropagation(),0<f.length&&(b=f.shift(),b.shift().apply(null,b)))},!0);b.callAsync=function(){f.push(Array.prototype.slice.call(arguments));g.postMessage(a,"*")};b.createAsyncHandler=function(a){return function(){var c=Array.prototype.slice.call(arguments);b.callAsync(function(){a.apply(null,c)})}}})(window,window.OTHelpers);
(function(g,b,f){b.eventing=function(a,d){function c(a,c,d){var e=h[a];if(e&&0!==e.length){var i=e.length;e.forEach(function(e){function f(a){return a.context===e.context&&a.handler===e.handler}b.callAsync(function(){try{h[a]&&h[a].some(f)&&(e.closure||e.handler).apply(e.context||null,c)}finally{i--,0===i&&d&&d.apply(null,c.slice())}})})}}function e(a,b){var c=h[a];c&&0!==c.length&&c.forEach(function(a){(a.closure||a.handler).apply(a.context||null,b)})}var h={},i=!0===d?e:c,f=function(a,b){h[a]&&
(b?h[a]=h[a].filter(function(a){return a.context!==b}):delete h[a])},g=function(a,b,c,d){var e={handler:b};c&&(e.context=c);d&&(e.closure=d);a.forEach(function(a){h[a]||(h[a]=[]);h[a].push(e)})}.bind(a),l=function(a,b,c){function d(a){return!(a.handler===b&&a.context===c)}a.forEach(function(a){h[a]&&(h[a]=h[a].filter(d),0===h[a].length&&delete h[a])})}.bind(a);a.dispatchEvent=function(a,c){if(!a.type)throw b.error("OTHelpers.Eventing.dispatchEvent: Event has no type"),b.error(a),Error("OTHelpers.Eventing.dispatchEvent: Event has no type");
a.target||(a.target=this);if(!h[a.type]||0===h[a.type].length){var d=[a];c&&c.apply(null,d.slice())}else return i(a.type,[a],c),this};a.trigger=function(a){if(h[a]&&0!==h[a].length){var b=Array.prototype.slice.call(arguments);b.shift();i(a,b);return this}};a.on=function(a,b,c){if("string"===typeof a&&b)g(a.split(" "),b,c);else for(var d in a)a.hasOwnProperty(d)&&g([d],a[d],b);return this};a.off=function(a,c,d){if("string"===typeof a)c&&b.isFunction(c)?l(a.split(" "),c,d):a.split(" ").forEach(function(a){f(a,
c)},this);else if(a)for(var e in a)a.hasOwnProperty(e)&&l([e],a[e],c);else h={};return this};a.once=function(a,b,c){var d=a.split(" "),a=function(){var a=b.apply(c||null,arguments);l(d,b,c);return a}.bind(this);g(d,b,c,a);return this};a.addEventListener=function(a,b,c){g([a],b,c)};a.removeEventListener=function(a,b,c){l([a],b,c)};return a};b.eventing.Event=function(){return function(a,d){this.type=a;this.cancelable=d!==f?d:!0;var c=!1,e=null;this.preventDefault=function(){this.cancelable?c=!0:b.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")};
this.isDefaultPrevented=function(){return c};b.canDefineProperty&&Object.defineProperty(this,"target",{set:function(a){e=a},get:function(){return e}})}}})(window,window.OTHelpers);
(function(g,b){function f(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}b.supportsClassList=function(){var a=typeof("undefined"!==document)&&"classList"in document.createElement("a");b.supportsClassList=function(){return a};return a};b.removeElement=function(a){a&&a.parentNode&&a.parentNode.removeChild(a)};b.removeElementById=function(a){this.removeElement(b(a))};b.removeElementsByType=function(a,b){if(a)for(var c=a.getElementsByTagName(b);c.length;)a.removeChild(c[0])};b.emptyElement=
function(a){for(;a.firstChild;)a.removeChild(a.firstChild);return a};b.createElement=function(a,b,c){a=document.createElement(a);if(b)for(var e in b)if("object"===typeof b[e]){a[e]||(a[e]={});var h=b[e],i;for(i in h)a[e][i]=h[i]}else"className"===e?a.className=b[e]:a.setAttribute(e,b[e]);c&&(a.innerHTML=c);return a};b.createButton=function(a,d,c){a=b.createElement("button",d,a);if(c){for(var e in c)if(c.hasOwnProperty(e))b.on(a,e,c[e]);a._boundEvents=c}return a};b.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,
c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var e=a["on"+b];a["on"+b]=function(){c.apply(this,arguments);e&&e.apply(this,arguments)}}};b.off=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)};b.isDisplayNone=function(a){return(0===a.offsetWidth||0===a.offsetHeight)&&"none"===b.css(a,"display")?!0:a.parentNode&&a.parentNode.style?b.isDisplayNone(a.parentNode):!1};b.findElementWithDisplayNone=function(a){return(0===a.offsetWidth||
0===a.offsetHeight)&&"none"===b.css(a,"display")?a:a.parentNode&&a.parentNode.style?b.findElementWithDisplayNone(a.parentNode):null};b.observeStyleChanges=function(a,d,c){var e={},h=function(c){switch(c){case "width":return b.width(a);case "height":return b.height(a);default:return b.css(a)}};d.forEach(function(a){e[a]=h(a)});var i=new MutationObserver(function(a){var i={};a.forEach(function(a){"style"===a.attributeName&&d.forEach(function(a){var b=h(a);b!==e[a]&&(i[a]=[e[a],b],e[a]=b)})});f(i)&&
b.callAsync(function(){c.call(null,i)})});i.observe(a,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1});return i};b.observeNodeOrChildNodeRemoval=function(a,d){var c=new MutationObserver(function(a){var c=[];a.forEach(function(a){a.removedNodes.length&&(c=c.concat(Array.prototype.slice.call(a.removedNodes)))});c.length&&b.callAsync(function(){d(c)})});c.observe(a,{attributes:!1,childList:!0,characterData:!1,subtree:!0});return c}})(window,window.OTHelpers);
(function(g,b){b.Modal=function(f,a){this.el=b.createElement("section",{className:"OT_root OT_dialog OT_modal"},b.template("        <header>            <h1><%= title %></h1>        </header>        <div class='OT_dialog-body'>            <%= body %>        </div>    ",{title:f,body:a}));this.el.style.display="none";document.body.appendChild(this.el);b.centerElement(this.el);b.show(this.el);this.close=function(){b.removeElement(this.el);this.el=null;return this}};b.tbAlert=function(f,a){var d=new b.Modal(f,
"<div>"+a+"</div>");b.addClass(d.el,"OT_tbalert");var c=b.createElement("input",{className:"OT_closeButton",type:"button",value:"close"});d.el.appendChild(c);c.onclick=function(){d&&d.close();d=null}}})(window,window.OTHelpers);
(function(g,b){b.addClass=function(a,d){if(1===a.nodeType){var c=d.trim().split(/\s+/),e,h;if(b.supportsClassList()){e=0;for(h=c.length;e<h;++e)a.classList.add(c[e])}else{if(!a.className&&1===c.length)a.className=d;else{var i=" "+a.className+" ";e=0;for(h=c.length;e<h;++e)~i.indexOf(" "+c[e]+" ")||(i+=c[e]+" ");a.className=i.trim()}return this}}};b.removeClass=function(a,d){if(d&&1===a.nodeType){var c=d.trim().split(/\s+/),e,h;if(b.supportsClassList()){e=0;for(h=c.length;e<h;++e)a.classList.remove(c[e])}else{var i=
(" "+a.className+" ").replace(/[\s+]/," ");e=0;for(h=c.length;e<h;++e)i=i.replace(" "+c[e]+" "," ");a.className=i.trim();return this}}};var f=function(a){return 0<a.offsetHeight?a.offsetHeight+"px":b.css(a,"height")};b.width=function(a,d){return d?(b.css(a,"width",d),this):b.isDisplayNone(a)?b.makeVisibleAndYield(a,function(){return 0<a.offsetWidth?a.offsetWidth+"px":b.css(a,"width")}):0<a.offsetWidth?a.offsetWidth+"px":b.css(a,"width")};b.height=function(a,d){return d?(b.css(a,"height",d),this):
b.isDisplayNone(a)?b.makeVisibleAndYield(a,function(){return f(a)}):f(a)};b.centerElement=function(a,d,c){d||(d=parseInt(b.width(a),10));c||(c=parseInt(b.height(a),10));b.css(a,"margin",-0.5*c+"px 0 0 "+(-0.5*d+"px"));b.addClass(a,"OT_centered")}})(window,window.OTHelpers);
(function(g,b,f){var a={},d={};b.show=function(c){var e=c.style.display;if(""===e||"none"===e)c.style.display=a[c]||"",delete a[c];if("none"===c.ownerDocument.defaultView.getComputedStyle(c,null).getPropertyValue("display")){a[c]="none";e=c.style;if(d[c.ownerDocument]&&d[c.ownerDocument][c.nodeName])c=d[c.ownerDocument][c.nodeName];else{d[c.ownerDocument]||(d[c.ownerDocument]={});var h=c.ownerDocument.createElement(c.nodeName);c.ownerDocument.body.appendChild(h);c=d[c.ownerDocument][c.nodeName]=b.css(h,
"display");b.removeElement(h)}e.display=c}return this};b.hide=function(b){if("none"!==b.style.display)return a[b]=b.style.display,b.style.display="none",this};b.css=function(a,b,d){if("string"!==typeof b){var a=a.style,i;for(i in b)a[i]=b[i];return this}if(d!==f)return a.style[b]=d,this;b=b.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase();i=a.ownerDocument.defaultView.getComputedStyle(a,null).getPropertyValue(b);""===i&&(i=a.style[b]);return i};b.applyCSS=function(a,d,h){var i={},f;for(f in d)d.hasOwnProperty(f)&&
(i[f]=a.style[f],b.css(a,f,d[f]));h=h();for(f in d)d.hasOwnProperty(f)&&b.css(a,f,i[f]||"");return h};b.makeVisibleAndYield=function(a,d){var h=b.findElementWithDisplayNone(a);if(h)return b.applyCSS(h,{display:"block",visibility:"hidden"},d)}})(window,window.OTHelpers);
(function(g,b,f){function a(a){if("string"===typeof a)return a;var b=[],d;for(d in a)b.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return b.join("&").replace(/\+/g,"%20")}b.getXML=function(a,d){var h=d&&d.success,i=b.extend(d.headers||{},{"Content-Type":"application/xml"});b.get(a,b.extend(d||{},{success:function(a){var b=a.target.responseXML,c;b?(c=b.documentElement,c=!c||!c.nodeName||"parsererror"===c.nodeName?!1:!0):c=!1;c?h&&h(b,a,a.target):d&&d.error&&d.error(a,a.target)},headers:i}))};
b.getJSON=function(a,d){var h=d&&d.success;b.get(a,b.extend(d||{},{success:function(a){var b;try{b=JSON.parse(a.target.responseText)}catch(c){d&&d.error&&d.error(a,a.target);return}h&&h(b,a,a.target)},headers:{"Content-Type":"application/json"}}))};b.get=function(a,b){var h=new XMLHttpRequest,f=b||{};d(h,f.success,f.error);f.process&&h.addEventListener("progress",f.progress,!1);f.cancelled&&h.addEventListener("abort",f.cancelled,!1);h.open("GET",a,!0);f.headers||(f.headers={});for(var g in f.headers)h.setRequestHeader(g,
f.headers[g]);h.send()};b.post=function(b,e){var h=new XMLHttpRequest,f=e||{};d(h,f.success,f.error);f.process&&h.addEventListener("progress",f.progress,!1);f.cancelled&&h.addEventListener("abort",f.cancelled,!1);h.open("POST",b,!0);f.headers||(f.headers={});for(var g in f.headers)h.setRequestHeader(g,f.headers[g]);h.send(a(f.data))};b.postFormData=function(a,d,h){if(!d)throw Error("OTHelpers.postFormData must be passed a data options.");var f=new FormData,g;for(g in d)f.append(g,d[g]);b.post(a,b.extend(h||
{},{data:f}))};b.getJSONP=function(a,d){var h,i=document.head||document.getElementsByTagName("head")[0],g,j=a,l=b.extend(d||{},{callbackParameter:"callback"}),m=function(){g&&(clearTimeout(g),g=null);h&&(h.onload=h.onreadystatechange=null,b.removeElement(h),h=f)},p=function(){if((!h.readyState||/loaded|complete/.test(h.readyState))&&g)clearTimeout(g),g=null};l.callbackName="jsonp_callback_"+ +new Date;this.jsonp_callbacks[l.callbackName]=function(a){m();l.success&&l.success(a)};j+=(/\?/.test(j)?"&":
"?")+l.callbackParameter+"="+l.callbackName;h=b.createElement("script",{async:"async",src:j,onload:p,onreadystatechange:p});i.appendChild(h);g=setTimeout(function(){m();b.error("The JSONP request to "+j+" timed out after 30000ms.");l.error&&l.error("The JSONP request to "+a+" timed out after 30000ms.",j,l)},3E4)};var d=function(a,b,d){a.addEventListener("load",function(a){var c=a.target.status;200<=c&&300>c||304===c?b&&b.apply(null,arguments):d&&d(a)},!1);d&&a.addEventListener("error",d,!1)}})(window,
window.OTHelpers);
!function(g){g.OT||(g.OT={});OT.$=OTHelpers.noConflict();OT.$.eventing(OT);OT.Modal=OT.$.Modal;OT.$.useLogHelpers(OT);var b=!1,f=OT.setLogLevel;OT.setLogLevel=function(a){OT.$.setLogLevel(a);a=f.call(OT,a);if(OT.shouldLog(OT.DEBUG)&&!b){OT.debug("OpenTok JavaScript library "+OT.properties.version);OT.debug("Release notes: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html");OT.debug("Known issues: "+OT.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html#knownIssues");b=
true}OT.debug("TB.setLogLevel("+a+")");return a};OT.setLogLevel(OT.properties.debug?OT.DEBUG:OT.ERROR)}(window);
(function(g){g.OT||(g.OT={});if(!OT.properties)throw Error("OT.properties does not exist, please ensure that you include a valid properties file.");var b=OT,f=OT.properties,a=OT.$.clone(f);a.debug="true"===f.debug||!0===f.debug;a.supportSSL="true"===f.supportSSL||!0===f.supportSSL;a.supportSSL&&(0<=g.location.protocol.indexOf("https")||0<=g.location.protocol.indexOf("chrome-extension"))?(a.assetURL=a.cdnURLSSL+"/webrtc/"+a.version,a.loggingURL=a.loggingURLSSL,a.apiURL=a.apiURLSSL):a.assetURL=a.cdnURL+
"/webrtc/"+a.version;a.configURL=a.assetURL+"/js/dynamic_config.min.js";a.cssURL=a.assetURL+"/css/ot.min.css";b.properties=a})(window);
(function(){OT.Config=function(){var g=!1,b={},f={},a,d=document.head||document.getElementsByTagName("head")[0],c,e=function(){c&&(clearTimeout(c),c=null);a&&(a.onload=a.onreadystatechange=null,d&&a.parentNode&&d.removeChild(a),a=void 0)},h=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))c&&(clearTimeout(c),c=null),g||i._onLoadTimeout()},i={loadTimeout:4E3,load:function(b){if(!b)throw Error("You must pass a valid configUrl to Config.load");g=!1;setTimeout(function(){a=document.createElement("script");
a.async="async";a.src=b;a.onload=a.onreadystatechange=h.bind(this);d.appendChild(a)},1);c=setTimeout(function(){i._onLoadTimeout()},this.loadTimeout)},_onLoadTimeout:function(){e();OT.warn("TB DynamicConfig failed to load in "+i.loadTimeout+" ms");this.trigger("dynamicConfigLoadFailed")},isLoaded:function(){return g},reset:function(){e();g=!1;b={};f={}},replaceWith:function(a){e();a||(a={});b=a.global||{};f=a.partners||{};g||(g=!0);this.trigger("dynamicConfigChanged")},get:function(a,c,d){a=d&&f[d]&&
f[d][a]?f[d][a]:b[a];return a?a[c]:null}};OT.$.eventing(i);return i}()})(window);
(function(){function g(a,d,c,e,h){d=d?parseInt(d,10):parseInt(OT.$.width(a.parentNode),10);c=c?parseInt(c,10):parseInt(OT.$.height(a.parentNode),10);if(!(0===d||0===c))if(e||(e=b),c=(d+0)/c,d={width:"100%",height:"100%",left:0,top:0},c>e?(e=100*(c/e),d.height=e+"%",d.top="-"+(e-100)/2+"%"):c<e&&(e=100*(e/c),d.width=e+"%",d.left="-"+(e-100)/2+"%"),OT.$.css(a,d),e=a.querySelector("video"))h?(h=a.offsetWidth,a=a.offsetHeight,d={width:a+"px",height:h+"px",marginTop:"",marginLeft:""},a=h-a,d.marginLeft=
a/2+"px",d.marginTop=-(a/2)+"px",OT.$.css(e,d)):OT.$.css(e,{width:"",height:"",marginTop:"",marginLeft:""})}var b=4/3,f=function(a,b){var c,e;a&&a.nodeName?(c=a,(!c.getAttribute("id")||0===c.getAttribute("id").length)&&c.setAttribute("id","OT_"+OT.$.uuid()),e=c.getAttribute("id")):(c=OT.$(a),e=a||"OT_"+OT.$.uuid());c?OT.$.emptyElement(c):(c=OT.$.createElement("div",{id:e}),c.style.backgroundColor="#000000",document.body.appendChild(c));null==b||"replace"==b||(e=document.createElement("div"),e.id=
"OT_"+OT.$.uuid(),"append"==b?(c.appendChild(e),c=e):"before"==b?(c.parentNode.insertBefore(e,c),c=e):"after"==b&&(c.parentNode.insertBefore(e,c.nextSibling),c=e));return c};OT.WidgetView=function(a,b){var c=f(a,b&&b.insertMode),e=document.createElement("div"),h,i,k,j,l,m=!0;b&&(width=b.width,height=b.height,width&&"number"==typeof width&&(width+="px"),height&&"number"==typeof height&&(height+="px"),c.style.width=width?width:"264px",c.style.height=height?height:"198px",c.style.overflow="hidden",(void 0===
b.mirror||b.mirror)&&OT.$.addClass(c,"OT_mirrored"));b.classNames&&OT.$.addClass(c,b.classNames);OT.$.addClass(c,"OT_loading");OT.$.addClass(e,"OT_video-container");e.style.width=c.style.width;e.style.height=c.style.height;c.appendChild(e);g(e,c.offsetWidth,c.offsetHeight);l=document.createElement("div");OT.$.addClass(l,"OT_video-loading");e.appendChild(l);j=document.createElement("div");OT.$.addClass(j,"OT_video-poster");e.appendChild(j);h=OT.$.observeStyleChanges(c,["width","height"],function(a){g(e,
a.width?a.width[1]:c.offsetWidth,a.height?a.height[1]:c.offsetHeight,i?i.aspectRatio:null)});k=OT.$.observeNodeOrChildNodeRemoval(c,function(a){if(i){if(a.some(function(a){return a===e||a.nodeName==="VIDEO"})){i.destroy();i=null}if(e){OT.$.removeElement(e);e=null}if(h){h.disconnect();h=null}if(k){k.disconnect();k=null}}});this.destroy=function(){if(h){h.disconnect();h=null}if(k){k.disconnect();k=null}if(i){i.destroy();i=null}if(c){OT.$.removeElement(c);c=null}};Object.defineProperties(this,{showPoster:{get:function(){return!OT.$.isDisplayNone(j)},
set:function(a){a?OT.$.show(j):OT.$.hide(j)}},poster:{get:function(){return OT.$.css(j,"backgroundImage")},set:function(a){OT.$.css(j,"backgroundImage","url("+a+")")}},loading:{get:function(){return m},set:function(a){(m=a)?OT.$.addClass(c,"OT_loading"):OT.$.removeClass(c,"OT_loading")}},video:{get:function(){return i},set:function(a){i&&i.destroy();a.appendTo(e);i=a;i.on({orientationChanged:function(){g(e,c.offsetWidth,c.offsetHeight,i.aspectRatio,i.isRotated)}});g(e,c.offsetWidth,c.offsetHeight,
i?i.aspectRatio:null,i?i.isRotated:null)}},domElement:{get:function(){return c}},domId:{get:function(){return c.getAttribute("id")}}});this.addError=function(a){c.innerHTML="<p>"+a+"<p>";OT.$.addClass(c,"OT_subscriber_error")}}})(window);
(function(g){var b=function(){if(navigator.getUserMedia)return navigator.getUserMedia.bind(navigator);if(navigator.mozGetUserMedia)return navigator.mozGetUserMedia.bind(navigator);if(navigator.webkitGetUserMedia)return navigator.webkitGetUserMedia.bind(navigator)}();if(navigator.webkitGetUserMedia){if(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=
function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams}),!webkitRTCPeerConnection.prototype.getRemoteStreams)webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}else if(navigator.mozGetUserMedia&&(MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),!MediaStream.prototype.getAudioTracks))MediaStream.prototype.getAudioTracks=
function(){return[]};var f={PERMISSION_DENIED:"PERMISSION_DENIED",NOT_SUPPORTED_ERROR:"A constraint specified is not supported by the browser.",MANDATORY_UNSATISFIED_ERROR:"CONSTRAINT_NOT_SATISFIED"},a={1:"PERMISSION_DENIED"},d={PERMISSION_DENIED:"User denied permission for scripts from this origin to access the media device.",CONSTRAINT_NOT_SATISFIED:"One of the mandatory constraints could not be satisfied."},c=function(a,b){var c=b[a],e=d[c];e||(e=eventName,c=a);return{name:c,message:e}},e=function(a){if(!a||
!OT.$.isObject(a))return!0;for(var b in a)if(a[b])return!1;return!0};OT.$.supportsWebRTC=function(){var a=!1;if(navigator.webkitGetUserMedia)a="function"===typeof webkitRTCPeerConnection&&!!webkitRTCPeerConnection.prototype.addStream;else if(navigator.mozGetUserMedia){var b=g.navigator.userAgent.toLowerCase().match(/Firefox\/([0-9\.]+)/i);if(a="function"===typeof mozRTCPeerConnection&&null!==b&&20<parseFloat(b[1],10))try{new mozRTCPeerConnection,a=!0}catch(c){a=!1}}OT.$.supportsWebRTC=function(){return a};
return a};OT.$.supportedCryptoScheme=function(){if(!OT.$.supportsWebRTC())return"NONE";var a=g.navigator.userAgent.toLowerCase().match(/chrome\/([0-9\.]+)/i);return a&&25>parseFloat(a[1],10)?"SDES_SRTP":"DTLS_SRTP"};OT.$.supportsBundle=function(){return OT.$.supportsWebRTC()&&"Chrome"===OT.$.browser()};OT.$.supportsRtcpMux=function(){return OT.$.supportsWebRTC()&&"Chrome"===OT.$.browser()};OT.$.getUserMedia=function(d,i,g,j,l,m){if(e(d))OT.error("Couldn't get UserMedia: All constraints were false"),
g.call(null,{name:"NO_VALID_CONSTRAINTS",message:"Video and Audio was disabled, you need to enabled at least one"});else{var p=null,n=!1,r=function(){p=null;n=!0;j&&j()},q=function(a){p&&clearTimeout(p);n&&l&&l();i.call(null,a)},o=function(b){p&&clearTimeout(p);n&&l&&l();var d;if(OT.$.isObject(b)&&b.name)d={name:b.name,message:b.message,constraintName:b.constraintName};else if(OT.$.isObject(b)){if(d=c(b.code,a),b.message&&(d.message=b.message),b.constraintName)d.constraintName=b.constraintName}else d=
b&&f.hasOwnProperty(b)?c(b,f):{message:"Unknown Error while getting user media"};b=d;"PERMISSION_DENIED"===b.name?m.call(null,b):g.call(null,b)};try{b(d,q,o)}catch(s){OT.error("Couldn't get UserMedia: "+s.toString());o();return}-1===location.protocol.indexOf("https")?setTimeout(r,100):p=setTimeout(r,500)}}})(window);
(function(g){function b(a,b){var c=document.createElement("video");c.setAttribute("autoplay","");c.innerHTML=a;if(b){!0===b.muted&&(delete b.muted,c.muted="true");for(var d in b)c.setAttribute(d,b[d])}return c}function f(a){return c[parseInt(a,10)]||"An unknown error occurred."}function a(a,b,c,d){if(navigator.mozGetUserMedia||0<b.getVideoTracks().length&&b.getVideoTracks()[0].enabled){var j=function(){clearTimeout(p);a.removeEventListener("loadedmetadata",l,!1);a.removeEventListener("error",m,!1)},
l=function(){j();c()},m=function(a){j();d("There was an unexpected problem with the Video Stream: "+f(a.target.error.code))},p=setTimeout(function(){0===a.currentTime?d("The video stream failed to connect. Please notify the site owner if this continues to happen."):(OT.warn("Never got the loadedmetadata event but currentTime > 0"),c())}.bind(this),3E4);a.addEventListener("loadedmetadata",l,!1);a.addEventListener("error",m,!1);b.onended=function(){j();d("Stream ended while trying to bind it to a video element.")}}else c();
void 0!==a.srcObject?a.srcObject=b:void 0!==a.mozSrcObject?a.mozSrcObject=b:a.src=g.URL.createObjectURL(b);a.play()}OT.VideoOrientation={ROTATED_NORMAL:"OTVideoOrientationRotatedNormal",ROTATED_LEFT:"OTVideoOrientationRotatedLeft",ROTATED_RIGHT:"OTVideoOrientationRotatedRight",ROTATED_UPSIDE_DOWN:"OTVideoOrientationRotatedUpsideDown"};OT.VideoElement=function(c){var d,i,k,j=!1,l=!1,c=OT.$.defaults(c||{},{fallbackText:"Sorry, Web RTC is not available in your browser"});OT.$.eventing(this);var m=function(a){this.trigger("error",
null,"There was an unexpected problem with the Video Stream: "+f(a.target.error.code),this)}.bind(this),p=function(){j=!0;i.addEventListener("error",m,!1);this.trigger("streamBound",this)}.bind(this),n=function(a){this.trigger("loadError",OT.ExceptionCodes.P2P_CONNECTION_FAILED,a,this)}.bind(this),r=function(){l||(OT.warn("Video element paused, auto-resuming. If you intended to do this, use publishVideo(false) or subscribeToVideo(false) instead."),l=!0);i.play()};i=b(c.fallbackText,c.attributes);
i.addEventListener("pause",r);Object.defineProperties(this,{stream:{get:function(){return d}},domElement:{get:function(){return i}},parentElement:{get:function(){return k}},isBoundToStream:{get:function(){return j}},poster:{get:function(){return i.getAttribute("poster")},set:function(a){i.setAttribute("poster",a)}}});this.appendTo=function(a){k=a;k.appendChild(i);return this};this.bindToStream=function(b){j=!1;d=b;a(i,d,p,n);return this};this.unbindStream=function(){if(!d)return this;i&&(navigator.mozGetUserMedia?
i.mozSrcObject=null:g.URL.revokeObjectURL(i.src));d=null;return this};this.setAudioVolume=function(a){i&&(i.volume=OT.$.roundFloat(a/100,2))};this.getAudioVolume=function(){return i?parseInt(100*i.volume,10):50};this.whenTimeIncrements=function(a,b){if(i){var c,d=function(){!c||c>=i.currentTime?c=i.currentTime:(i.removeEventListener("timeupdate",d,!1),a.call(b,this))}.bind(this);i.addEventListener("timeupdate",d,!1)}};this.destroy=function(){this.off();this.unbindStream();i&&(i.removeEventListener("pause",
r),OT.$.removeElement(i),i=null);k=null}};OT.$.canDefineProperty&&Object.defineProperties(OT.VideoElement.prototype,{imgData:{get:function(){var a=OT.$.createElement("canvas",{width:this.domElement.videoWidth,height:this.domElement.videoHeight,style:{display:"none"}});document.body.appendChild(a);try{a.getContext("2d").drawImage(this.domElement,0,0,a.width,a.height)}catch(b){return OT.warn("Cannot get image data yet"),null}var c=a.toDataURL("image/png");OT.$.removeElement(a);return c.replace("data:image/png;base64,",
"").trim()}},videoWidth:{get:function(){return this._orientation&&this._orientation.width?this._orientation.width:this.domElement["video"+(this.isRotated?"Height":"Width")]}},videoHeight:{get:function(){return this._orientation&&this._orientation.height?this._orientation.height:this.domElement["video"+(this.isRotated?"Width":"Height")]}},aspectRatio:{get:function(){return(this.videoWidth+0)/this.videoHeight}},isRotated:{get:function(){return this._orientation&&("OTVideoOrientationRotatedLeft"==this._orientation.videoOrientation||
"OTVideoOrientationRotatedRight"==this._orientation.videoOrientation)}}});var d={OTVideoOrientationRotatedNormal:"rotate(0deg)",OTVideoOrientationRotatedLeft:"rotate(90deg)",OTVideoOrientationRotatedRight:"rotate(-90deg)",OTVideoOrientationRotatedUpsideDown:"rotate(180deg)"};OT.$.canDefineProperty&&Object.defineProperty(OT.VideoElement.prototype,"orientation",{get:function(){return this._orientation},set:function(a){this._orientation=a;a=d[a.videoOrientation]||d.ROTATED_NORMAL;switch(OT.$.browser()){case "Chrome":case "Safari":this.domElement.style.webkitTransform=
a;break;case "IE":this.domElement.style.msTransform=a;break;default:this.domElement.style.transform=a}this.trigger("orientationChanged")}});var c={};g.MediaError&&(c[g.MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.",c[g.MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.",c[g.MediaError.MEDIA_ERR_DECODE]=
"An error of some description occurred while decoding the media resource, after the resource was established to be usable.",c[g.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable. ")})(window);
(function(g){var b=[],f=!1;OT.Analytics=function(){var a=OT.properties.loggingURL+"/logging/ClientEvent",d=OT.properties.loggingURL+"/logging/ClientQos",c={},e={payloadType:"payload_type",partnerId:"partner_id",streamId:"stream_id",sessionId:"session_id",connectionId:"connection_id",widgetType:"widget_type",widgetId:"widget_id",avgAudioBitrate:"avg_audio_bitrate",avgVideoBitrate:"avg_video_bitrate"},h=function(b,c,h,e){OT.$.post(c?d:a,{success:h,error:e,data:b,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},
i=function(){if(!f&&0<b.length){f=!0;var a=b[0],c=function(){b.shift();f=!1;i()};a&&h(a.data,a.isQos,function(){a.onComplete();setTimeout(c,50)},function(){OT.debug("Failed to send ClientEvent, moving on to the next item.");setTimeout(c,50)})}};this.logError=function(a,b,d,h,e){e||(e={});d=e.partnerId;if(!0===OT.Config.get("exceptionLogging","enabled",d)){var f;d?(f=[d,b,a].join("_"),f=100>=(c[f]||0)):f=!1;if(!f){var d=[d,b,a].join("_"),g=this.escapePayload(OT.$.extend(h||{},{message:g,userAgent:navigator.userAgent}));
c[d]="undefined"!==typeof c[d]?c[d]+1:1;return this.logEvent(OT.$.extend(e,{action:b+"."+a,payloadType:g[0],payload:g[1]}))}}};this.logEvent=function(a){var c=a.partnerId;a||(a={});var a=OT.$.extend({variation:"",guid:this.getClientGuid(),widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:c,source:g.location.href,section:"",build:""},a),d;for(d in e)e.hasOwnProperty(d)&&a[d]&&(a[e[d]]=a[d],delete a[d]);b.push({data:a,onComplete:function(){},isQos:!1});i()};this.logQOS=function(a){var c=
a.partnerId;a||(a={});var a=OT.$.extend({guid:this.getClientGuid(),widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:c,source:g.location.href,build:"",duration:0},a),d;for(d in e)e.hasOwnProperty(d)&&a[d]&&(a[e[d]]=a[d],delete a[d]);b.push({data:a,onComplete:function(){},isQos:!0});i()};this.escapePayload=function(a){var b=[],c=[],d;for(d in a)a.hasOwnProperty(d)&&(null!==a[d]&&void 0!==a[d])&&(b.push(a[d]?a[d].toString().replace("|","\\|"):""),c.push(d.toString().replace("|","\\|")));
return[c.join("|"),b.join("|")]};this.getClientGuid=function(){var a=OT.$.getCookie("opentok_client_id");a||(a=OT.$.uuid(),OT.$.setCookie("opentok_client_id",a));return a}}})(window);
(function(g){"file:"===location.protocol&&alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.");g.OT||(g.OT={});!g.URL&&g.webkitURL&&(g.URL=g.webkitURL);var b,f=document.location.hash;OT.initSession=function(a){var b=OT.sessions.get(a);if(!b){b=new OT.Session(a);OT.sessions.add(b)}return b};OT.initPublisher=function(a,b,c,e){OT.debug("TB.initPublisher("+b+")");var h=new OT.Publisher;OT.publishers.add(h);if(e&&OT.$.isFunction(e)){a=
function k(a){h.off("initSuccess",k);h.off("publishComplete",k);e.apply(null,arguments)};h.once("initSuccess",a);h.once("publishComplete",a)}h.publish(b,c);return h};OT.checkSystemRequirements=function(){OT.debug("TB.checkSystemRequirements()");var a=OT.$.supportsWebSockets()&&OT.$.supportsWebRTC()?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS;OT.checkSystemRequirements=function(){OT.debug("TB.checkSystemRequirements()");return a};return a};OT.upgradeSystemRequirements=function(){OT.onLoad(function(){for(var a=
false,d=document.getElementsByTagName("meta"),c=0;c<d.length;c++){var e=d[c].httpEquiv,h=d[c].content;if(e&&e.toLowerCase()==="x-ua-compatible"&&h&&h.toLowerCase().indexOf("chrome=1")>-1){a=true;break}}document.body.appendChild(function(){var b=document.createElement("iframe");b.id="_upgradeFlash";b.style.position="absolute";b.style.position="fixed";b.style.height="100%";b.style.width="100%";b.style.top="0px";b.style.left="0px";b.style.right="0px";b.style.bottom="0px";b.style.zIndex=1E3;try{b.style.backgroundColor=
"rgba(0,0,0,0.2)"}catch(c){b.style.backgroundColor="transparent";b.setAttribute("allowTransparency","true")}b.setAttribute("frameBorder","0");b.frameBorder="0";b.scrolling="no";b.setAttribute("scrolling","no");b.src=OT.properties.assetURL+"/html/upgradeFlash.html"+(a?"?cf=1":"")+"#"+encodeURIComponent(document.location.href);return b}());b&&clearInterval(b);b=setInterval(function(){var a=document.location.hash,b=/^#?\d+&/;if(a!==f&&b.test(a)){f=a;if(a.replace(b,"")==="close_window"){document.body.removeChild(document.getElementById("_upgradeFlash"));
document.location.hash=""}else if(a.replace(b,"")==="installed_gcf"){document.location.hash="";document.location.href=document.location.href.replace("#","")}}},100)})};OT.reportIssue=function(){OT.warn("ToDo: haven't yet implemented TB.reportIssue")};OT.components={};OT.sessions={};OT.rtc={};OT.APIKEY=function(){var a=document.getElementsByTagName("script"),a=a[a.length-1],a=a.getAttribute("src")||a.src;return(a=a.match(/[\?\&]apikey=([^&]+)/i))?a[1]:""}();OT.HAS_REQUIREMENTS=1;OT.NOT_HAS_REQUIREMENTS=
0;g.OT||(g.OT=OT);g.TB||(g.TB=OT)})(window);
(function(){OT.Collection=function(g){var b=[],f={},a=g||"id";OT.$.eventing(this,!0);var d=function(a){this.trigger("update",a);this.trigger("update:"+a.target.id,a)}.bind(this),c=function(a,b){if(void 0!==f[a]){var c=f[a];delete f[a];f[b]=c}}.bind(this),e=function(a){this.remove(a.target,a.reason)}.bind(this);this.reset=function(){b.forEach(function(a){a.off("updated",d,this);a.off("destroyed",e,this);a.off("idUpdated",c,this)},this);b=[];f={}};this.destroy=function(){b.forEach(function(a){a.destroy(void 0,
!0)});this.reset();this.off()};this.get=function(a){return a&&void 0!==f[a]?b[f[a]]:void 0};this.has=function(a){return a&&void 0!==f[a]};this.toString=function(){return b.toString()};this.where=function(a,c){return OT.$.isFunction(a)?b.filter(a,c):b.filter(function(b){for(var c in a)if(b[c]!==a[c])return!1;return!0})};this.find=function(a,c){var d;d=OT.$.isFunction(a)?a:function(b){for(var c in a)if(b[c]!==a[c])return!1;return!0};d=d.bind(c);for(var e=0;e<b.length;++e)if(!0===d(b[e]))return b[e];
return null};this.add=function(h){var g=h[a];if(this.has(g))return OT.warn("Model "+g+" is already in the collection",b),this;f[g]=b.push(h)-1;h.on("updated",d,this);h.on("destroyed",e,this);h.on("idUpdated",c,this);this.trigger("add",h);this.trigger("add:"+g,h);return this};this.remove=function(h,g){var k=h[a];b.splice(f[k],1);for(var j=f[k];j<b.length;++j)f[b[j][a]]=j;delete f[k];h.off("updated",d,this);h.off("destroyed",e,this);h.off("idUpdated",c,this);this.trigger("remove",h,g);this.trigger("remove:"+
k,h,g);return this};OT.$.defineGetters(this,{length:function(){return b.length}})}})(this);
(function(){OT.Event=OT.$.eventing.Event();OT.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL:"signal",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",
MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",PUBLISHER_DESTROYED:"destroyed",SUBSCRIBER_DESTROYED:"destroyed",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",
CLOSE_BUTTON_CLICK:"closeButtonClick",MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",ENV_LOADED:"envLoaded"};OT.ValueEvent=function(g,b){OT.Event.call(this,g);this.value=b};OT.ExceptionCodes={JS_EXCEPTION:2E3,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,NOT_CONNECTED:1010,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SIGNAL:1510,UNABLE_TO_FORCE_DISCONNECT:1520,
UNABLE_TO_FORCE_UNPUBLISH:1530};OT.ExceptionEvent=function(g,b,f,a,d,c){OT.Event.call(this,g);this.message=b;this.title=f;this.code=a;this.component=d;this.target=c};OT.IssueReportedEvent=function(g,b){OT.Event.call(this,g);this.issueId=b};OT.EnvLoadedEvent=function(g){OT.Event.call(this,g)};OT.ConnectionEvent=function(g,b,f){OT.Event.call(this,g);this.connections=b;this.reason=f};OT.StreamEvent=function(g,b,f,a){OT.Event.call(this,g,a);this.streams=b;this.reason=f};OT.SessionConnectEvent=function(g,
b,f,a){OT.Event.call(this,g);this.connections=b;this.streams=f;this.archives=a;this.groups=[]};OT.SessionDisconnectEvent=function(g,b,f){OT.Event.call(this,g,f);this.reason=b};OT.VolumeEvent=function(g,b,f){OT.Event.call(this,g);this.streamId=b;this.volume=f};OT.DeviceEvent=function(g,b,f){OT.Event.call(this,g);this.camera=b;this.microphone=f};OT.DeviceStatusEvent=function(g,b,f,a,d){OT.Event.call(this,g);this.cameras=b;this.microphones=f;this.selectedCamera=a;this.selectedMicrophone=d};OT.ResizeEvent=
function(g,b,f,a,d){OT.Event.call(this,g);this.widthFrom=b;this.widthTo=f;this.heightFrom=a;this.heightTo=d};OT.StreamPropertyChangedEvent=function(g,b,f,a,d){OT.Event.call(this,g);this.type=g;this.stream=b;this.changedProperty=f;this.oldValue=a;this.newValue=d};OT.ArchiveEvent=function(g,b){OT.Event.call(this,g);this.archives=b};OT.ArchiveStreamEvent=function(g,b,f){OT.Event.call(this,g);this.archive=b;this.streams=f};OT.StateChangedEvent=function(g,b){OT.Event.call(this,g);this.changedValues=b};
OT.ChangeFailedEvent=function(g,b,f,a){OT.Event.call(this,g);this.reasonCode=b;this.reason=f;this.failedValues=a};OT.SignalEvent=function(g,b,f){OT.Event.call(this,g?"signal:"+g:OT.Event.names.SIGNAL,!1);this.data=b;this.from=f};OT.StreamUpdatedEvent=function(g,b,f,a){OT.Event.call(this,"updated");this.target=g;this.changedProperty=b;this.oldValue=f;this.newValue=a};OT.DestroyedEvent=function(g,b,f){OT.Event.call(this,g,!1);this.target=b;this.reason=f}})(window);
(function(g){function b(a,b,c){return b<=a&&a<=c}function f(a,b){return Math.floor(a/b)}function a(a){var b=0;this.get=function(){return b>=a.length?-1:Number(a[b])};this.offset=function(c){b+=c;if(0>b)throw Error("Seeking past start of the buffer");if(b>a.length)throw Error("Seeking past EOF");};this.match=function(c){if(c.length>b+a.length)return!1;var d;for(d=0;d<c.length;d+=1)if(Number(a[b+d])!==c[d])return!1;return!0}}function d(a){var b=0;this.emit=function(c){var d=-1,e;for(e=0;e<arguments.length;++e)d=
Number(arguments[e]),a[b++]=d;return d}}function c(a){var c=0,d=function(a){for(var c=[],d=0,e=a.length;d<a.length;){var f=a.charCodeAt(d);if(b(f,55296,57343))if(b(f,56320,57343))c.push(65533);else if(d===e-1)c.push(65533);else{var h=a.charCodeAt(d+1);b(h,56320,57343)?(f&=1023,h&=1023,d+=1,c.push(65536+(f<<10)+h)):c.push(65533)}else c.push(f);d+=1}return c}(a);this.offset=function(a){c+=a;if(0>c)throw Error("Seeking past start of the buffer");if(c>d.length)throw Error("Seeking past EOF");};this.get=
function(){return c>=d.length?-1:d[c]}}function e(){var a="";this.string=function(){return a};this.emit=function(b){65535>=b?a+=String.fromCharCode(b):(b-=65536,a+=String.fromCharCode(55296+(b>>10&1023)),a+=String.fromCharCode(56320+(b&1023)))}}function h(a){this.name="EncodingError";this.message=a;this.code=0}function i(a,b){if(a)throw new h("Decoder error");return b||65533}function k(a){throw new h("The code point "+a+" could not be encoded.");}function j(a){a=(""+a).trim().toLowerCase();return Object.prototype.hasOwnProperty.call(H,
a)?H[a]:null}function l(a,b){return(b||[])[a]||null}function m(a,b){var c=b.indexOf(a);return-1===c?null:c}function p(a){var c=a.fatal,d=0,e=0,f=0,h=0;this.decode=function(a){var g=a.get();if(-1===g)return 0!==e?i(c):-1;a.offset(1);if(0===e){if(b(g,0,127))return g;if(b(g,194,223))e=1,h=128,d=g-192;else if(b(g,224,239))e=2,h=2048,d=g-224;else if(b(g,240,244))e=3,h=65536,d=g-240;else return i(c);d*=Math.pow(64,e);return null}if(!b(g,128,191))return h=f=e=d=0,a.offset(-1),i(c);f+=1;d+=(g-128)*Math.pow(64,
e-f);if(f!==e)return null;a=d;g=h;h=f=e=d=0;return b(a,g,1114111)&&!b(a,55296,57343)?a:i(c)}}function n(){this.encode=function(a,c){var d=c.get();if(-1===d)return-1;c.offset(1);if(b(d,55296,57343))return k(d);if(b(d,0,127))return a.emit(d);var e,h;b(d,128,2047)?(e=1,h=192):b(d,2048,65535)?(e=2,h=224):b(d,65536,1114111)&&(e=3,h=240);for(h=a.emit(f(d,Math.pow(64,e))+h);0<e;)h=f(d,Math.pow(64,e-1)),h=a.emit(128+h%64),e-=1;return h}}function r(a,c){var d=c.fatal;this.decode=function(c){var e=c.get();
if(-1===e)return-1;c.offset(1);if(b(e,0,127))return e;c=a[e-128];return null===c?i(d):c}}function q(a){this.encode=function(c,d){var e=d.get();if(-1===e)return-1;d.offset(1);if(b(e,0,127))return c.emit(e);var f=m(e,a);null===f&&k(e);return c.emit(f+128)}}function o(a,c){var d=c.fatal,e=0,f=0,h=0;this.decode=function(c){var g=c.get();if(-1===g&&0===e&&0===f&&0===h)return-1;if(-1===g&&(0!==e||0!==f||0!==h))h=f=e=0,i(d);c.offset(1);var j;if(0!==h){j=null;if(b(g,48,57))if(g=10*(126*(10*(e-129)+(f-48))+
(h-129))+g-48,39419<g&&189E3>g||1237575<g)j=null;else{var k=0;j=0;var w=u.gb18030,A;for(A=0;A<w.length;++A){var G=w[A];if(G[0]<=g)k=G[0],j=G[1];else break}j=j+g-k}h=f=e=0;return null===j?(c.offset(-3),i(d)):j}if(0!==f){if(b(g,129,254))return h=g,null;c.offset(-2);f=e=0;return i(d)}if(0!==e){if(b(g,48,57)&&a)return f=g,null;j=e;k=null;e=0;w=127>g?64:65;if(b(g,64,126)||b(g,128,254))k=190*(j-129)+(g-w);j=null===k?null:l(k,u.gbk);null===k&&c.offset(-1);return null===j?i(d):j}return b(g,0,127)?g:128===
g?8364:b(g,129,254)?(e=g,null):i(d)}}function s(a){this.encode=function(c,d){var e=d.get();if(-1===e)return-1;d.offset(1);if(b(e,0,127))return c.emit(e);var h=m(e,u.gbk);if(null!==h)return e=f(h,190)+129,h%=190,c.emit(e,h+(63>h?64:65));if(null===h&&!a)return k(e);var g=h=0,i=u.gb18030,j;for(j=0;j<i.length;++j){var w=i[j];if(w[1]<=e)h=w[1],g=w[0];else break}h=g+e-h;e=f(f(f(h,10),126),10);h-=12600*e;g=f(f(h,10),126);h-=1260*g;i=f(h,10);return c.emit(e+129,g+48,i+129,h-10*i+48)}}function x(a){var c=
a.fatal,d=!1,e=0;this.decode=function(a){var f=a.get();if(-1===f&&0===e)return-1;if(-1===f&&0!==e)return e=0,i(c);a.offset(1);if(126===e){e=0;if(123===f)return d=!0,null;if(125===f)return d=!1,null;if(126===f)return 126;if(10===f)return null;a.offset(-1);return i(c)}if(0!==e){a=e;e=0;var h=null;b(f,33,126)&&(h=l(190*(a-1)+(f+63),u.gbk));10===f&&(d=!1);return null===h?i(c):h}if(126===f)return e=126,null;if(d){if(b(f,32,127))return e=f,null;10===f&&(d=!1);return i(c)}return b(f,0,127)?f:i(c)}}function v(){var a=
!1;this.encode=function(c,d){var e=d.get();if(-1===e)return-1;d.offset(1);if(b(e,0,127)&&a)return d.offset(-1),a=!1,c.emit(126,125);if(126===e)return c.emit(126,126);if(b(e,0,127))return c.emit(e);if(!a)return d.offset(-1),a=!0,c.emit(126,123);var h=m(e,u.gbk);if(null===h)return k(e);var g=f(h,190)+1,h=h%190-63;return!b(g,33,126)||!b(h,33,126)?k(e):c.emit(g,h)}}function y(a){var c=a.fatal,d=0,e=null;this.decode=function(a){if(null!==e)return a=e,e=null,a;var f=a.get();if(-1===f&&0===d)return-1;if(-1===
f&&0!==d)return d=0,i(c);a.offset(1);if(0!==d){var h=d,g=null;d=0;var j=127>f?64:98;if(b(f,64,126)||b(f,161,254))g=157*(h-129)+(f-j);if(1133===g)return e=772,202;if(1135===g)return e=780,202;if(1164===g)return e=772,234;if(1166===g)return e=780,234;f=null===g?null:l(g,u.big5);null===g&&a.offset(-1);return null===f?i(c):f}return b(f,0,127)?f:b(f,129,254)?(d=f,null):i(c)}}function B(){this.encode=function(a,c){var d=c.get();if(-1===d)return-1;c.offset(1);if(b(d,0,127))return a.emit(d);var e=m(d,u.big5);
if(null===e)return k(d);d=f(e,157)+129;e%=157;return a.emit(d,e+(63>e?64:98))}}function z(a){var c=a.fatal,d=0,e=0;this.decode=function(a){var f=a.get();if(-1===f){if(0===d&&0===e)return-1;e=d=0;return i(c)}a.offset(1);var h,g;return 0!==e?(h=e,e=0,g=null,b(h,161,254)&&b(f,161,254)&&(g=l(94*(h-161)+f-161,u.jis0212)),b(f,161,254)||a.offset(-1),null===g?i(c):g):142===d&&b(f,161,223)?(d=0,65377+f-161):143===d&&b(f,161,254)?(d=0,e=f,null):0!==d?(h=d,d=0,g=null,b(h,161,254)&&b(f,161,254)&&(g=l(94*(h-161)+
f-161,u.jis0208)),b(f,161,254)||a.offset(-1),null===g?i(c):g):b(f,0,127)?f:142===f||143===f||b(f,161,254)?(d=f,null):i(c)}}function w(){this.encode=function(a,c){var d=c.get();if(-1===d)return-1;c.offset(1);if(b(d,0,127))return a.emit(d);if(165===d)return a.emit(92);if(8254===d)return a.emit(126);if(b(d,65377,65439))return a.emit(142,d-65377+161);var e=m(d,u.jis0208);if(null===e)return k(d);d=f(e,94)+161;return a.emit(d,e%94+161)}}function D(a){var c=a.fatal,d=0,e=!1,f=0;this.decode=function(a){var h=
a.get();-1!==h&&a.offset(1);switch(d){default:case 0:return 27===h?(d=1,null):b(h,0,127)?h:-1===h?-1:i(c);case 1:if(36===h||40===h)return f=h,d=2,null;-1!==h&&a.offset(-1);d=0;return i(c);case 2:var g=f;f=0;if(36===g&&(64===h||66===h))return e=!1,d=4,null;if(36===g&&40===h)return d=3,null;if(40===g&&(66===h||74===h))return d=0,null;if(40===g&&73===h)return d=6,null;-1===h?a.offset(-1):a.offset(-2);d=0;return i(c);case 3:if(68===h)return e=!0,d=4,null;-1===h?a.offset(-2):a.offset(-3);d=0;return i(c);
case 4:if(10===h)return d=0,i(c,10);if(27===h)return d=1,null;if(-1===h)return-1;f=h;d=5;return null;case 5:d=4;if(-1===h)return i(c);a=null;g=94*(f-33)+h-33;b(f,33,126)&&b(h,33,126)&&(a=!1===e?l(g,u.jis0208):l(g,u.jis0212));return null===a?i(c):a;case 6:return 27===h?(d=1,null):b(h,33,95)?65377+h-33:-1===h?-1:i(c)}}}function C(){var a=0;this.encode=function(c,d){var e=d.get();if(-1===e)return-1;d.offset(1);if((b(e,0,127)||165===e||8254===e)&&0!==a)return d.offset(-1),a=0,c.emit(27,40,66);if(b(e,
0,127))return c.emit(e);if(165===e)return c.emit(92);if(8254===e)return c.emit(126);if(b(e,65377,65439)&&2!==a)return d.offset(-1),a=2,c.emit(27,40,73);if(b(e,65377,65439))return c.emit(e-65377-33);if(1!==a)return d.offset(-1),a=1,c.emit(27,36,66);var h=m(e,u.jis0208);if(null===h)return k(e);e=f(h,94)+33;return c.emit(e,h%94+33)}}function A(a){var c=a.fatal,d=0;this.decode=function(a){var e=a.get();if(-1===e&&0===d)return-1;if(-1===e&&0!==d)return d=0,i(c);a.offset(1);if(0!==d){var f=d;d=0;if(b(e,
64,126)||b(e,128,252))return a=l(188*(f-(160>f?129:193))+e-(127>e?64:65),u.jis0208),null===a?i(c):a;a.offset(-1);return i(c)}return b(e,0,128)?e:b(e,161,223)?65377+e-161:b(e,129,159)||b(e,224,252)?(d=e,null):i(c)}}function E(){this.encode=function(a,c){var d=c.get();if(-1===d)return-1;c.offset(1);if(b(d,0,128))return a.emit(d);if(165===d)return a.emit(92);if(8254===d)return a.emit(126);if(b(d,65377,65439))return a.emit(d-65377+161);var e=m(d,u.jis0208);if(null===e)return k(d);d=f(e,188);e%=188;return a.emit(d+
(31>d?129:193),e+(63>e?64:65))}}function I(a){var c=a.fatal,d=0;this.decode=function(a){var e=a.get();if(-1===e&&0===d)return-1;if(-1===e&&0!==d)return d=0,i(c);a.offset(1);if(0!==d){var f=d,h=null;d=0;if(b(f,129,198)){var g=178*(f-129);b(e,65,90)?h=g+e-65:b(e,97,122)?h=g+26+e-97:b(e,129,254)&&(h=g+26+26+e-129)}b(f,199,253)&&b(e,161,254)&&(h=12460+94*(f-199)+(e-161));e=null===h?null:l(h,u["euc-kr"]);null===h&&a.offset(-1);return null===e?i(c):e}return b(e,0,127)?e:b(e,129,253)?(d=e,null):i(c)}}function J(){this.encode=
function(a,c){var d=c.get();if(-1===d)return-1;c.offset(1);if(b(d,0,127))return a.emit(d);var e=m(d,u["euc-kr"]);if(null===e)return k(d);if(12460>e)return d=f(e,178)+129,e%=178,a.emit(d,e+(26>e?65:52>e?71:77));e-=12460;d=f(e,94)+199;return a.emit(d,e%94+161)}}function K(a){var c=a.fatal,d=0,e=0;this.decode=function(a){var f=a.get();-1!==f&&a.offset(1);switch(d){default:case 0:return 14===f?(d=4,null):15===f?null:27===f?(d=1,null):b(f,0,127)?f:-1===f?-1:i(c);case 1:if(36===f)return d=2,null;-1!==f&&
a.offset(-1);d=0;return i(c);case 2:if(41===f)return d=3,null;-1===f?a.offset(-1):a.offset(-2);d=0;return i(c);case 3:if(67===f)return d=0,null;-1===f?a.offset(-2):a.offset(-3);d=0;return i(c);case 4:if(10===f)return d=0,i(c,10);if(14===f)return null;if(15===f)return d=0,null;if(-1===f)return-1;e=f;d=5;return null;case 5:d=4;if(-1===f)return i(c);a=null;b(e,33,70)&&b(f,33,126)?a=l(178*(e-1)+52+f-1,u["euc-kr"]):b(e,71,126)&&b(f,33,126)&&(a=l(12460+94*(e-71)+(f-33),u["euc-kr"]));return null!==a?a:i(c)}}}
function F(){var a=!1,c=0;this.encode=function(d,e){var h=e.get();if(-1===h)return-1;a||(a=!0,d.emit(27,36,41,67));e.offset(1);if(b(h,0,127)&&0!==c)return e.offset(-1),c=0,d.emit(15);if(b(h,0,127))return d.emit(h);if(1!==c)return e.offset(-1),c=1,d.emit(14);var g=m(h,u["euc-kr"]);if(null===g)return k(h);var i;if(12460>g)return i=f(g,178)+1,g=g%178-26-26+1,!b(i,33,70)||!b(g,33,126)?k(h):d.emit(i,g);g-=12460;i=f(g,94)+71;g=g%94+33;return!b(i,71,126)||!b(g,33,126)?k(h):d.emit(i,g)}}function N(a,d){var c=
d.fatal,e=null,f=null;this.decode=function(d){var h=d.get();if(-1===h&&null===e&&null===f)return-1;if(-1===h&&(null!==e||null!==f))return i(c);d.offset(1);if(null===e)return e=h,null;h=a?(e<<8)+h:(h<<8)+e;e=null;if(null!==f){var g=f;f=null;if(b(h,56320,57343))return 65536+1024*(g-55296)+(h-56320);d.offset(-2);return i(c)}return b(h,55296,56319)?(f=h,null):b(h,56320,57343)?i(c):h}}function O(a){this.encode=function(d,c){function e(b){var c=b>>8,b=b&255;return a?d.emit(c,b):d.emit(b,c)}var h=c.get();
if(-1===h)return-1;c.offset(1);b(h,55296,57343)&&k(h);if(65535>=h)return e(h);var g=f(h-65536,1024)+55296,h=(h-65536)%1024+56320;e(g);return e(h)}}function L(a,b){if(!this||this===g)return new L(a,b);a=a?""+a:"utf-8";b=Object(b);this._encoding=j(a);if(null===this._encoding||"utf-8"!==this._encoding.name&&"utf-16"!==this._encoding.name&&"utf-16be"!==this._encoding.name)throw new TypeError("Unknown encoding: "+a);this._streaming=!1;this._encoder=null;this._options={fatal:Boolean(b.fatal)};Object.defineProperty?
Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name;return this}function M(a,b){if(!this||this===g)return new M(a,b);a=a?""+a:"utf-8";b=Object(b);this._encoding=j(a);if(null===this._encoding)throw new TypeError("Unknown encoding: "+a);this._streaming=!1;this._decoder=null;this._options={fatal:Boolean(b.fatal)};Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name;
return this}if(!(void 0!==g.TextEncoder&&void 0!==g.TextDecoder)){h.prototype=Error.prototype;var t={},H={};[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:"csisolatin2 iso-8859-2 iso-ir-101 iso8859-2 iso_8859-2 l2 latin2".split(" "),name:"iso-8859-2"},{labels:"csisolatin3 iso-8859-3 iso_8859-3 iso-ir-109 l3 latin3".split(" "),name:"iso-8859-3"},
{labels:"csisolatin4 iso-8859-4 iso_8859-4 iso-ir-110 l4 latin4".split(" "),name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:"arabic csisolatinarabic ecma-114 iso-8859-6 iso_8859-6 iso-ir-127".split(" "),name:"iso-8859-6"},{labels:"csisolatingreek ecma-118 elot_928 greek greek8 iso-8859-7 iso_8859-7 iso-ir-126".split(" "),name:"iso-8859-7"},{labels:"csisolatinhebrew hebrew iso-8859-8 iso-8859-8-i iso-ir-138 iso_8859-8 visual".split(" "),
name:"iso-8859-8"},{labels:"csisolatin6 iso-8859-10 iso-ir-157 iso8859-10 l6 latin6".split(" "),name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620",
"windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:"ascii ansi_x3.4-1968 csisolatin1 iso-8859-1 iso8859-1 iso_8859-1 l1 latin1 us-ascii windows-1252".split(" "),name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:"csisolatin5 iso-8859-9 iso-ir-148 l5 latin5 windows-1254".split(" "),name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256",
"windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:"chinese csgb2312 csiso58gb231280 gb2312 gbk gb_2312 gb_2312-80 iso-ir-58 x-gbk".split(" "),name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},
{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:"csshiftjis ms_kanji shift-jis shift_jis sjis windows-31j x-sjis".split(" "),name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:"cseuckr csksc56011987 euc-kr iso-ir-149 korean ks_c_5601-1987 ks_c_5601-1989 ksc5601 ksc_5601 windows-949".split(" "),
name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}].forEach(function(a){a.encodings.forEach(function(a){t[a.name]=a;a.labels.forEach(function(b){H[b]=a})})});var u=g["encoding-indexes"]||{};t["utf-8"].getEncoder=function(a){return new n(a)};t["utf-8"].getDecoder=function(a){return new p(a)};(function(){"ibm864 ibm866 iso-8859-2 iso-8859-3 iso-8859-4 iso-8859-5 iso-8859-6 iso-8859-7 iso-8859-8 iso-8859-10 iso-8859-13 iso-8859-14 iso-8859-15 iso-8859-16 koi8-r koi8-u macintosh windows-874 windows-1250 windows-1251 windows-1252 windows-1253 windows-1254 windows-1255 windows-1256 windows-1257 windows-1258 x-mac-cyrillic".split(" ").forEach(function(a){var b=
t[a],d=u[a];b.getDecoder=function(a){return new r(d,a)};b.getEncoder=function(a){return new q(d,a)}})})();t.gbk.getEncoder=function(a){return new s(!1,a)};t.gbk.getDecoder=function(a){return new o(!1,a)};t.gb18030.getEncoder=function(a){return new s(!0,a)};t.gb18030.getDecoder=function(a){return new o(!0,a)};t["hz-gb-2312"].getEncoder=function(a){return new v(a)};t["hz-gb-2312"].getDecoder=function(a){return new x(a)};t.big5.getEncoder=function(a){return new B(a)};t.big5.getDecoder=function(a){return new y(a)};
t["euc-jp"].getEncoder=function(a){return new w(a)};t["euc-jp"].getDecoder=function(a){return new z(a)};t["iso-2022-jp"].getEncoder=function(a){return new C(a)};t["iso-2022-jp"].getDecoder=function(a){return new D(a)};t.shift_jis.getEncoder=function(a){return new E(a)};t.shift_jis.getDecoder=function(a){return new A(a)};t["euc-kr"].getEncoder=function(a){return new J(a)};t["euc-kr"].getDecoder=function(a){return new I(a)};t["iso-2022-kr"].getEncoder=function(a){return new F(a)};t["iso-2022-kr"].getDecoder=
function(a){return new K(a)};t["utf-16"].getEncoder=function(a){return new O(!1,a)};t["utf-16"].getDecoder=function(a){return new N(!1,a)};t["utf-16be"].getEncoder=function(a){return new O(!0,a)};t["utf-16be"].getDecoder=function(a){return new N(!0,a)};L.prototype={encode:function(a,b){a=a?""+a:"";b=Object(b);this._streaming||(this._encoder=this._encoding.getEncoder(this._options));this._streaming=Boolean(b.stream);for(var e=[],f=new d(e),h=new c(a);-1!==h.get();)this._encoder.encode(f,h);if(!this._streaming){var g;
do g=this._encoder.encode(f,h);while(-1!==g);this._encoder=null}return new Uint8Array(e)}};M.prototype={decode:function(b,d){if(b&&!("buffer"in b&&"byteOffset"in b&&"byteLength"in b))throw new TypeError("Expected ArrayBufferView");b||(b=new Uint8Array(0));d=Object(d);this._streaming||(this._decoder=this._encoding.getDecoder(this._options));this._streaming=Boolean(d.stream);var c=new Uint8Array(b.buffer,b.byteOffset,b.byteLength),c=new a(c);if(!this._BOMseen){this._BOMseen=!0;var f=this._encoding.name;
c.match([255,254])&&"utf-16"===f?c.offset(2):c.match([254,255])&&"utf-16be"==f?c.offset(2):c.match([239,187,191])&&"utf-8"==f&&c.offset(3)}for(var f=new e,h;-1!==c.get();)h=this._decoder.decode(c),null!==h&&-1!==h&&f.emit(h);if(!this._streaming){do h=this._decoder.decode(c),null!==h&&-1!==h&&f.emit(h);while(-1!==h&&-1!=c.get());this._decoder=null}return f.string()}};g.TextEncoder=g.TextEncoder||L;g.TextDecoder=g.TextDecoder||M}})(this);
(function(){OT.Rumor={MessageType:{SUBSCRIBE:0,UNSUBSCRIBE:1,MESSAGE:2,CONNECT:3,DISCONNECT:4,PING:7,PONG:8,STATUS:9}}})(this);
(function(){var g={1002:"The endpoint is terminating the connection due to a protocol error. (CLOSE_PROTOCOL_ERROR)",1003:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data). (CLOSE_UNSUPPORTED)",1004:"The endpoint is terminating the connection because a data frame was received that is too large. (CLOSE_TOO_LARGE)",1005:"Indicates that no status code was provided even though one was expected. (CLOSE_NO_STATUS)",
1006:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected. (CLOSE_ABNORMAL)",1007:"Indicates that an endpoint is terminating the connection because it has received data within a message that was not consistent with the type of the message (e.g., non-UTF-8 [RFC3629] data within a text message)",1008:"Indicates that an endpoint is terminating the connection because it has received a message that violates its policy.  This is a generic status code that can be returned when there is no other more suitable status code (e.g., 1003 or 1009) or if there is a need to hide specific details about the policy",
1009:"Indicates that an endpoint is terminating the connection because it has received a message that is too big for it to process",1011:"Indicates that a server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request",4001:"Connectivity loss was detected as it was too long since the socket received the last PONG message"};OT.Rumor.SocketError=function(b,f){this.code=b;this.message=f};OT.Rumor.Socket=function(b,f,a){var d,c,e,h,i,
k,j,l,m,p,n,r=OT.$.statable(this,["disconnected","error","connected","connecting","disconnecting"],"disconnected",function(a){switch(a){case "disconnected":case "error":if(d=null,i){var b;if(!p?0:44900<=OT.$.now()-p)b=Error(g[4001]),b.code=4001;i(b)}}}),q=function(a,b){if(null===b||!OT.$.isFunction(b))throw Error("The Rumor.Socket "+a+" callback must be a valid function or null");},o=function(a){OT.error("Rumor.Socket: "+a);a=new OT.Rumor.SocketError(null,a||"Unknown Socket Error");m&&clearTimeout(m);
r("error");"connecting"===this.previousState&&j&&(j(a,null),j=null);h&&h(a)}.bind(this),s=function C(a){d&&(void 0===a&&(a=0),l&&clearTimeout(l),0<d.bufferedAmount&&10>=a+1?l=setTimeout(C,100,a+1):(r("disconnecting"),l&&(clearTimeout(l),l=null),console.info("CALLED CLOSE ON WEBSOCKET"),d.close()))},x=function A(){this.is("connected")&&((!p?0:44900<=OT.$.now()-p)?z({code:4001}):(d.send(OT.Rumor.Message.Ping().serialize()),n=setTimeout(A.bind(this),9E3)))}.bind(this),v=function(){m&&clearTimeout(m);
d.send(OT.Rumor.Message.Connect(c,f).serialize());r("connected");j&&(j(null,c),j=null);e&&e(c);setTimeout(function(){p=OT.$.now();x()},9E3)},y=function(){o("Timed out while waiting for the Rumor socket to connect.")},B=function(){},z=function(a){m&&clearTimeout(m);n&&clearTimeout(n);if(1E3!==a.code&&1001!==a.code){var b=a.reason||a.message;!b&&g.hasOwnProperty(a.code)&&(b=g[a.code]);o("Rumor Socket Disconnected: "+b)}this.isNot("error")&&r("disconnected")}.bind(this),w=function(a){p=OT.$.now();k&&
(a=OT.Rumor.Message.deserialize(a.data),a.type!==OT.Rumor.MessageType.PONG&&k(a.toAddress,a.data))};this.publish=function(a,b){d.send(OT.Rumor.Message.Publish(a,b).serialize())};this.subscribe=function(a){d.send(OT.Rumor.Message.Subscribe(a).serialize())};this.unsubscribe=function(a){d.send(OT.Rumor.Message.Unsubscribe(a).serialize())};this.connect=function(e,f){if(this.is("connecting","connected"))f(null,"Rumor.Socket cannot connect when it is already connecting or connected.");else{c=e;j=f;try{r("connecting"),
d=new (a||WebSocket)(b),d.binaryType="arraybuffer",d.onopen=v,d.onclose=z,d.onerror=B,d.onmessage=w,m=setTimeout(y,OT.Rumor.Socket.CONNECT_TIMEOUT)}catch(h){OT.error(h),o("Could not connect to the Rumor socket, possibly because of a blocked port.")}}};this.disconnect=function(){m&&clearTimeout(m);n&&clearTimeout(n);d?3===d.readyState?this.isNot("error")&&r("disconnected"):(this.is("connected")&&d.send(OT.Rumor.Message.Disconnect().serialize()),s()):this.isNot("error")&&r("disconnected")};Object.defineProperties(this,
{id:{get:function(){return c}},onOpen:{set:function(a){q("onOpen",a);e=a},get:function(){return e}},onError:{set:function(a){q("onError",a);h=a},get:function(){return h}},onClose:{set:function(a){q("onClose",a);i=a},get:function(){return i}},onMessage:{set:function(a){q("onMessage",a);k=a},get:function(){return k}}})};OT.Rumor.Socket.CONNECT_TIMEOUT=15E3})(this);
(function(){OT.Rumor.Message=function(g,b,f,a){this.type=g;this.toAddress=b;this.headers=f;this.data=a};OT.Rumor.Message.prototype.serialize=function(){var g=8,b=7,f=Array(this.toAddress.length),a=Array(this.headers.length),d=Array(this.headers.length),c;b++;for(var e=0;e<this.toAddress.length;e++)f[e]=TextEncoder("utf-8").encode(this.toAddress[e]),b+=2,b+=f[e].length;b++;for(e=0;e<this.headers.length;e++)a[e]=TextEncoder("utf-8").encode(this.headers[e].key),d[e]=TextEncoder("utf-8").encode(this.headers[e].val),
b+=4,b+=a[e].length,b+=d[e].length;c=TextEncoder("utf-8").encode(this.data);var b=b+c.length,h=new ArrayBuffer(b),i=new Uint8Array(h,0,b),b=b-4;i[0]=(b&4278190080)>>>24;i[1]=(b&16711680)>>>16;i[2]=(b&65280)>>>8;i[3]=(b&255)>>>0;i[4]=0;i[5]=0;i[6]=this.type;i[7]=this.toAddress.length;for(e=0;e<f.length;e++){strArray=f[e];i[g++]=strArray.length>>8&255;i[g++]=strArray.length>>0&255;for(b=0;b<strArray.length;b++)i[g++]=strArray[b]}i[g++]=a.length;for(e=0;e<a.length;e++){strArray=a[e];i[g++]=strArray.length>>
8&255;i[g++]=strArray.length>>0&255;for(b=0;b<strArray.length;b++)i[g++]=strArray[b];strArray=d[e];i[g++]=strArray.length>>8&255;i[g++]=strArray.length>>0&255;for(b=0;b<strArray.length;b++)i[g++]=strArray[b]}for(e=0;e<c.length;e++)i[g++]=c[e];return h};OT.Rumor.Message.deserialize=function(g){var b,f=8,a=new Uint8Array(g);b=a[6];for(var d=[],c=0;c<a[7];c++){length=a[f++]<<8;length+=a[f++];var e=new Uint8Array(g,f,length);d[c]=TextDecoder("utf-8").decode(e);f+=length}for(var h=a[f++],i=[],c=0;c<h;c++){length=
a[f++]<<8;length+=a[f++];var e=new Uint8Array(g,f,length),k=TextDecoder("utf-8").decode(e),f=f+length;length=a[f++]<<8;length+=a[f++];e=new Uint8Array(g,f,length);e=TextDecoder("utf-8").decode(e);i[c]={key:k,val:e};f+=length}g=new Uint8Array(g,f);g=TextDecoder("utf-8").decode(g);return new OT.Rumor.Message(b,d,i,g)};OT.Rumor.Message.Connect=function(g,b){return new OT.Rumor.Message(OT.Rumor.MessageType.CONNECT,[],[{key:"uniqueId",val:g},{key:"notifyDisconnectAddress",val:b}],"")};OT.Rumor.Message.Disconnect=
function(){return new OT.Rumor.Message(OT.Rumor.MessageType.DISCONNECT,[],[],"")};OT.Rumor.Message.Subscribe=function(g){return new OT.Rumor.Message(OT.Rumor.MessageType.SUBSCRIBE,g,[],"")};OT.Rumor.Message.Unsubscribe=function(g){return new OT.Rumor.Message(OT.Rumor.MessageType.UNSUBSCRIBE,g,[],"")};OT.Rumor.Message.Publish=function(g,b){return new OT.Rumor.Message(OT.Rumor.MessageType.MESSAGE,g,[],b)};OT.Rumor.Message.Ping=function(){return new OT.Rumor.Message(OT.Rumor.MessageType.PING,[],[],"")}})(this);
(function(){OT.Raptor={Actions:{CONNECT:100,CREATE:101,UPDATE:102,DELETE:103,STATE:104,FORCE_DISCONNECT:105,FORCE_UNPUBLISH:106,SIGNAL:107,CREATE_ARCHIVE:108,CLOSE_ARCHIVE:109,START_RECORDING_SESSION:110,STOP_RECORDING_SESSION:111,START_RECORDING_STREAM:112,STOP_RECORDING_STREAM:113,LOAD_ARCHIVE:114,START_PLAYBACK:115,STOP_PLAYBACK:116,APPSTATE_PUT:117,APPSTATE_DELETE:118,OFFER:119,ANSWER:120,PRANSWER:121,CANDIDATE:122,SUBSCRIBE:123,UNSUBSCRIBE:124,QUERY:125,SDP_ANSWER:126,PONG:127,REGISTER:128,QUALITY_CHANGED:129},
Types:{RPC_REQUEST:100,RPC_RESPONSE:101,STREAM:102,ARCHIVE:103,CONNECTION:104,APPSTATE:105,CONNECTIONCOUNT:106,MODERATION:107,SIGNAL:108,SUBSCRIBER:110,JSEP:109}}})(this);
(function(){var g={},b={},f=OT.Raptor.Types,a;for(a in f)g[f[a]]=a;f=OT.Raptor.Actions;for(a in f)b[f[a]]=a;OT.Raptor.serializeMessage=function(a){return JSON.stringify(a)};OT.Raptor.deserializeMessage=function(a){a=JSON.parse(a);a.type&&(a.type=parseInt(a.type,10),a.typeName=g[a.type]||null);a.action&&(a.action=parseInt(a.action,10),a.actionName=b[a.action]||null);a.signature=a.typeName+":"+a.actionName;return a};OT.Raptor.Message={};OT.Raptor.Message.connect=function(a,b,e,f,g,k){a={credentials:{connectionId:b,
soAccessState:2,supportsWebRTC:!0,p2pEnabled:k,GUID:a,widgetId:a,partnerId:f},sessionId:e,params:{tokenPermissions:{apiKey:f},token:g},uniqueId:b};return OT.Raptor.serializeMessage({id:OT.$.uuid(),type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.CONNECT,payload:a,replyTo:b})};OT.Raptor.Message.getSessionState=function(a,b,e){return OT.Raptor.serializeMessage({id:OT.$.uuid(),type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.STATE,payload:{sessionId:b,connectionsRequired:e||!0},replyTo:a})};
OT.Raptor.Message.forceDisconnect=function(a,b,e){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.FORCE_DISCONNECT,payload:{connectionId:b,sessionId:e},replyTo:a})};OT.Raptor.Message.streamCreate=function(a,b,e,f,g,k,j,l,m,p){b={key:b,value:{p2pEnabled:p||!1,publisherId:e,connection:{connectionId:a},type:"WebRTC",name:f||"",creationTime:Date.now(),orientation:{width:k,height:j,videoOrientation:g||"OTVideoOrientationRotatedNormal"},hasAudio:void 0!==
l?l:!0,hasVideo:void 0!==m?m:!0}};return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.STREAM,action:OT.Raptor.Actions.CREATE,payload:b,replyTo:""})};OT.Raptor.Message.streamDestroy=function(a,b,e){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.STREAM,action:OT.Raptor.Actions.DELETE,payload:{key:b+"/STREAMS/"+e},replyTo:a})};OT.Raptor.Message.streamModify=function(a,b,e,f,g){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.STREAM,action:OT.Raptor.Actions.UPDATE,payload:{key:[b,
"STREAMS",e,f].join("/"),value:g},replyTo:a})};OT.Raptor.Message.forceUnpublish=function(a,b,e){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.RPC_REQUEST,action:OT.Raptor.Actions.FORCE_UNPUBLISH,payload:{sessionId:b,connectionId:a,streamId:e,webRTCStream:!0},replyTo:a})};OT.Raptor.Message.jsepOffer=function(a,b,e,f){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.OFFER,payload:{fromAddress:a,toAddresses:b,sdp:f,streamId:e},replyTo:a})};OT.Raptor.Message.jsepAnswer=
function(a,b,e,f){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.ANSWER,payload:{fromAddress:a,toAddresses:b,sdp:f,streamId:e},replyTo:a})};OT.Raptor.Message.jsepSubscribe=function(a,b,e,f,g){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.SUBSCRIBE,payload:{keyManagemenMethod:OT.$.supportedCryptoScheme(),bundleSupport:OT.$.supportsBundle(),rtcpMuxSupport:OT.$.supportsRtcpMux(),fromAddress:a,toAddresses:b,streamId:e,
hasVideo:f,hasAudio:g},replyTo:a})};OT.Raptor.Message.jsepUnsubscribe=function(a,b,e){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.UNSUBSCRIBE,payload:{fromAddress:a,toAddresses:b,streamId:e},replyTo:a})};OT.Raptor.Message.jsepCandidate=function(a,b,e,f){return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.JSEP,action:OT.Raptor.Actions.CANDIDATE,payload:{fromAddress:a,toAddresses:b,candidate:f,streamId:e},replyTo:a})};OT.Raptor.Message.subscriberModify=
function(a,b,e,f,g,k){return OT.Raptor.serializeMessage({id:OT.$.uuid(),type:OT.Raptor.Types.SUBSCRIBER,action:OT.Raptor.Actions.UPDATE,payload:{key:[b,"SUBSCRIBER",e,a,g].join("/"),value:k},replyTo:a})};OT.Raptor.Message.signal=function(a,b,e,f,g){var k={id:OT.$.uuid(),fromAddress:a};k.toAddresses=f&&!Array.isArray(f)?[f]:!f||0===f.length?[b]:f;void 0!==e&&(k.type=e);void 0!==g&&(k.data=g);return OT.Raptor.serializeMessage({id:a,type:OT.Raptor.Types.SIGNAL,action:OT.Raptor.Actions.SIGNAL,payload:k,
replyTo:a})}})(this);
(function(){OT.Signal=function(g,b,f){var a=function(a){if(a){if(!Array.isArray(a))return{code:400,reason:"The To field was invalid"}}else return{code:400,reason:"The signal type was null or an empty String. Either set it to a non-empty String value or omit it"};for(var b=0;b<a.length;b++)if(!(a[b]instanceof OT.Connection||a[b]instanceof OT.Session))return{code:400,reason:"The To field was invalid"};return null},d=function(a){var b=null;null===a||void 0===a?b={code:400,reason:"The signal type was null or undefined. Either set it to a String value or omit it"}:128<
a.length?b={code:413,reason:"The signal type was too long, the maximum length of it is 128 characters"}:/^[a-zA-Z0-9\-\._~]+$/.exec(a)||(b={code:400,reason:"The signal type was invalid, it can only contain letters, numbers, '-', '_', and '~'."});return b},c=function(a){var b=null;if(null===a||void 0===a)b={code:400,reason:"The signal data was null or undefined. Either set it to a String value or omit it"};else try{8192<JSON.stringify(a).length&&(b={code:413,reason:"The data field was too long, the maximum size of it is 8192 characters"})}catch(c){b=
{code:400,reason:"The data field was not valid JSON"}}return b};this.toRaptorMessage=function(){var a;this.to&&(a=this.to.map(function(a){return"string"===typeof a?a:a.id}));return OT.Raptor.Message.signal(b,g,this.type,a,this.data)};this.toHash=function(){var a=OT.$.clone(f);void 0===a.to&&(a.to=null);void 0===a.data&&(a.data=null);return a};this.error=null;if(f&&(f.hasOwnProperty("data")&&(this.data=OT.$.clone(f.data),this.error=c(this.data)),f.hasOwnProperty("to")&&(this.to=Array.isArray(f.to)?
OT.$.clone(f.to):[f.to],this.error||(this.error=a(this.to))),f.hasOwnProperty("type")))this.error||(this.error=d(f.type)),this.type=f.type;this.valid=null===this.error}})(this);
(function(){function g(b,f,a){this.code=b;this.reason=f;this.signal=a}OT.Raptor.Socket=function(b,f,a){var d=OT.properties.messagingProtocol+"://"+f+":"+OT.properties.messagingPort+"/rumorwebsocketsv2",c="symphony."+f,e,h,i,k,j=new OT.Capabilities([]),l=new OT.Analytics,m=OT.$.statable(this,["disconnected","connecting","connected","error","disconnecting"],"disconnected"),p=function(a,c,d,f){a={action:"webSocketConnection",variation:a,payload_type:c,payload:d,session_id:e,partner_id:OT.APIKEY,widget_id:b,
widget_type:"Controller"};f&&(a=OT.$.extend(f,a));l.logEvent(a)},n=function(a,b){a?(p("Failure","reason",a.reason),m("error")):(p("Success","webSocketServerUrl",d,{connectionId:h.id}),m("connected"),j=new OT.Capabilities(b.permissions));k.apply(null,arguments)},r=function(a){var b=OT.sessions.get(e).connection,c=this.is("disconnecting")?"clientDisconnected":"networkDisconnected";a&&4001==a.code&&(c="networkTimedout");m("disconnected");b&&(b.destroyedReason?console.debug("OT.Raptor.Socket: Socket was closed but the connection had already been destroyed. Reason: "+
b.destroyedReason):b.destroy(c))}.bind(this),q=function(){};this.permittedTo=function(a){return 1===j[a]};this.connect=function(a,g,j){this.is("disconnected","error")?(m("connecting"),e=g.sessionId,k=j,j=OT.$.uuid(),OT.sessions.get(e),p("Attempt","webSocketServerUrl|userAgent|sdkVersion|chromeFrame",[d,navigator.userAgent,OT.properties.version,window.externalHost?"yes":"no"].map(function(a){return a.replace("|","\\|")}).join("|")),h=new OT.Rumor.Socket(d,c),h.onClose=r,h.onMessage=i.dispatch.bind(i),
h.connect(j,function(c){c?n(c):(h.onError=q,OT.debug("Raptor Socket connected to "+e+" on "+f),h.subscribe([e]),this.publish(OT.Raptor.Message.connect(b,h.id,e,OT.APIKEY,a,g.p2pEnabled)))}.bind(this))):OT.warn("Cannot connect the Raptor Socket as it is currently connected. You should disconnect first.")};this.disconnect=function(){this.is("disconnected")||(m("disconnecting"),h.disconnect())};this.publish=function(a){h.isNot("connected")?OT.error("OT.Raptor.Socket: cannot publish until the socket is connected."+
a):(OT.debug("OT.Raptor.Socket Publish: "+a),h.publish([c],a))};this.createStream=function(a,b,c,d,f,g,i){var j=OT.sessions.get(e);this.publish(OT.Raptor.Message.streamCreate(h.id,e,a,b,c,d,f,g,i,j.sessionInfo.p2pEnabled))};this.updateStream=function(a,b,c){this.publish(OT.Raptor.Message.streamModify(h.id,e,a,b,c))};this.destroyStream=function(a){this.publish(OT.Raptor.Message.streamDestroy(h.id,e,a))};this.modifySubscriber=function(a,b,c){this.publish(OT.Raptor.Message.subscriberModify(h.id,e,a.streamId,
a.widgetId,b,c))};this.forceDisconnect=function(a){this.publish(OT.Raptor.Message.forceDisconnect(h.id,a,e))};this.forceUnpublish=function(a){this.publish(OT.Raptor.Message.forceUnpublish(h.id,e,a))};this.jsepSubscribe=function(a,b,c,d){this.publish(OT.Raptor.Message.jsepSubscribe(h.id,a,b,c,d))};this.jsepUnsubscribe=function(a,b){this.publish(OT.Raptor.Message.jsepUnsubscribe(h.id,a,b))};this.jsepCandidate=function(a,b,c){this.publish(OT.Raptor.Message.jsepCandidate(h.id,a,b,c))};this.jsepOffer=
function(a,b,c){this.publish(OT.Raptor.Message.jsepOffer(h.id,a,b,c))};this.jsepAnswer=function(a,b,c){this.publish(OT.Raptor.Message.jsepAnswer(h.id,a,b,c))};this.signal=function(a,b){var c=new OT.Signal(e,h.id,a||{});c.valid?(this.publish(c.toRaptorMessage()),b&&OT.$.isFunction(b)&&b(null,c.toHash())):b&&OT.$.isFunction(b)&&b(new g(c.error.code,c.error.reason,c.toHash()))};OT.$.defineGetters(this,{id:function(){return h.id},capabilities:function(){return j},sessionId:function(){return e}});i=new (a||
OT.Raptor.Dispatcher)(this,n)}})(this);
(function(){function g(a,b){var c=new OT.Stream(a.streamId,b.connections.get(a.connection.connectionId),a.name,a.streamData,a.type,a.creationTime,a.hasAudio,a.hasVideo,a.orientation?a.orientation.videoOrientation:null,a.peerId,a.quality,a.orientation?a.orientation.width:null,a.orientation?a.orientation.height:null);a.publisherId&&(c.publisherId=a.publisherId);return c}function b(a,b){if(!b.streams.has(a.streamId)){var c=g(a,b);b.streams.add(c);return c}}var f={409:"This P2P session already has 2 participants.",
410:"The session already has four participants.",1004:"The token passed is invalid."};OT.publishers=new OT.Collection("guid");OT.subscribers=new OT.Collection("widgetId");OT.sessions=new OT.Collection;OT.Raptor.Dispatcher=function(a,b){this.socket=a;this.connectionCompletion=b};OT.Raptor.Dispatcher.prototype.dispatch=function(a,b){var c=OT.Raptor.deserializeMessage(b);if(c.typeName)if(c.actionName)switch(OT.debug("OT.Raptor.dispatch "+c.signature+": "+b),c.type){case OT.Raptor.Types.RPC_RESPONSE:this.dispatchRPCResponse(c);
break;case OT.Raptor.Types.CONNECTION:this.dispatchConnection(c);break;case OT.Raptor.Types.CONNECTIONCOUNT:this.dispatchConnectionCount(c);break;case OT.Raptor.Types.STREAM:this.dispatchStream(c);break;case OT.Raptor.Types.SUBSCRIBER:this.dispatchSubscriber(c);break;case OT.Raptor.Types.MODERATION:this.dispatchModeration(c);break;case OT.Raptor.Types.JSEP:this.dispatchJsep(c);break;case OT.Raptor.Types.SIGNAL:this.dispatchSignal(c);break;default:OT.warn("OT.Raptor.dispatch: Type "+c.typeName+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Invalid action ("+
c.action+") for "+c.typeName),OT.error(c);else OT.error("OT.Raptor.dispatch: Invalid message type ("+c.type+")")};OT.Raptor.Dispatcher.prototype.dispatchRPCResponse=function(a){switch(a.action){case OT.Raptor.Actions.CONNECT:!1==a.payload.connectSuccess?this.connectionCompletion.call(null,new OT.Error(OT.ExceptionCodes.CONNECT_REJECTED,f[a.payload.reason]||"Failed to connect")):this.socket.publish(OT.Raptor.Message.getSessionState(this.socket.id,a.payload.sessionId,!0));break;case OT.Raptor.Actions.STATE:var d=
a.payload.value,a=OT.sessions.get(a.payload.key),c;d.streams=[];d.connections=[];d.archives=[];if(d.hasOwnProperty("CONNECTIONS")){for(var e in d.CONNECTIONS)c=OT.Connection.fromHash(d.CONNECTIONS[e]),d.connections.push(c),a.connections.add(c);delete d.CONNECTIONS}if(d.hasOwnProperty("STREAMS")){for(e in d.STREAMS)d.streams.push(b(d.STREAMS[e],a));delete d.STREAMS}this.connectionCompletion.call(null,null,d);break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}};
OT.Raptor.Dispatcher.prototype.dispatchConnection=function(a){var b=OT.sessions.get(a.payload.value.sessionId),c;if(b)switch(a.action){case OT.Raptor.Actions.CREATE:c=OT.Connection.fromHash(a.payload.value);b.connection&&c.id!==b.connection.id&&b.connections.add(c);break;case OT.Raptor.Actions.DELETE:c=b.connections.get(a.payload.value.connectionId);c.destroy(a.payload.reason);break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Unable to determine session for "+
a.payload.value.sessionId+" on "+a.signature+" message!")};OT.Raptor.Dispatcher.prototype.dispatchConnectionCount=function(){};OT.Raptor.Dispatcher.prototype.dispatchStream=function(a){var d=a.payload.key.split("/"),c=d[0],e,f;c&&(e=OT.sessions.get(c));if(e)switch(a.action){case OT.Raptor.Actions.REGISTER:f=g(a.payload.value,e);f.publisherId&&((d=OT.publishers.get(f.publisherId))?d._.streamRegisteredHandler(f):OT.warn("OT.Raptor.dispatch: Could find a publisher "+f.publisherId+" for "+a.signature));
break;case OT.Raptor.Actions.CREATE:b(a.payload.value,e);break;case OT.Raptor.Actions.UPDATE:d[1]&&(f=e.streams.get(d[1]));if(!f){OT.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for "+a.signature+" message!");break}f.update(d[2],a.payload.value);break;case OT.Raptor.Actions.DELETE:d[2]&&(f=e.streams.get(d[2]));if(!f){OT.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for "+a.signature+" message!");break}f.destroy(a.payload.reason);
break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Unable to determine sessionId, or the session does not exist, for "+a.signature+" message!")};OT.Raptor.Dispatcher.prototype.dispatchModeration=function(){};OT.Raptor.Dispatcher.prototype.dispatchJsep=function(a){var b,c=a.payload.streamId,e;switch(a.action){case OT.Raptor.Actions.OFFER:e=[];(c=OT.subscribers.find({streamId:c}))&&e.push(c);break;case OT.Raptor.Actions.ANSWER:case OT.Raptor.Actions.PRANSWER:case OT.Raptor.Actions.SUBSCRIBE:case OT.Raptor.Actions.UNSUBSCRIBE:e=
OT.publishers.where({streamId:c});break;case OT.Raptor.Actions.CANDIDATE:e=OT.publishers.where({streamId:c}).concat(OT.subscribers.where({streamId:c}));break;default:OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented");return}e.length&&(b=e[0].session.connections.get(a.payload.fromAddress),!b&&a.payload.fromAddress.match(/^symphony\./)?(b=new OT.Connection(a.payload.fromAddress,Date.now(),null,{supportsWebRTC:!0}),e[0].session.connections.add(b)):b||OT.warn("Messsage comes from a connection ("+
a.payload.fromAddress+") that we do not know about."));e.forEach(function(c){c.processMessage(a.action,b,a.payload)})};OT.Raptor.Dispatcher.prototype.dispatchSubscriber=function(a){var b=a.payload.key.split("/"),c=OT.sessions.get(b[0]),e;if(c)if(e=b[2]?c.streams.get(b[2]):null)if(b=OT.subscribers.find(function(a){return a.streamId===e.id&&a.session.id===c.id}))switch(a.action){case OT.Raptor.Actions.QUALITY_CHANGED:b.updateQuality(parseInt(a.payload.value,10));break;default:OT.warn("OT.Raptor.dispatch: "+
a.signature+" is not currently implemented")}else OT.error("OT.Raptor.dispatch: Unable to determine subscriberId, or the subscriber does not exist, for "+a.signature+" message!");else OT.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for "+a.signature+" message!");else OT.error("OT.Raptor.dispatch: Unable to determine sessionId, or the session does not exist, for "+a.signature+" message!")};OT.Raptor.Dispatcher.prototype.dispatchSignal=function(a){if(a.action!==
OT.Raptor.Actions.SIGNAL)OT.warn("OT.Raptor.dispatch: "+a.signature+" is not currently implemented");else{var b=OT.sessions.get(this.socket.sessionId);b?b._.dispatchSignal(b.connections.get(a.payload.fromAddress),a.payload.type,a.payload.data):OT.error("OT.Raptor.dispatch: "+a.signature+" ERROR - sessionId must be provided and be valid")}}})(this);
(function(g){var b=new function(){var b=!1,a=!1,d=function(){a&&b&&OT.dispatchEvent(new OT.EnvLoadedEvent(OT.Event.names.ENV_LOADED))},c=function(){a=!0;OT.$.on(g,"beforeunload",function(){OT.publishers.destroy();OT.subscribers.destroy();OT.sessions.destroy()});OT.Config.load(OT.properties.configURL);d()},e=function(){b=!0;OT.Config.off("dynamicConfigChanged",e);OT.Config.off("dynamicConfigLoadFailed",h);d()},h=function(){e()};OT.Config.on("dynamicConfigChanged",e);OT.Config.on("dynamicConfigLoadFailed",
h);"complete"==document.readyState||"interactive"==document.readyState&&document.body?c():document.addEventListener?document.addEventListener("DOMContentLoaded",c,!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"==document.readyState&&c()});this.onLoad=function(c){if(a&&b)c();else OT.on(OT.Event.names.ENV_LOADED,c)}};OT.onLoad=function(f,a){if(a)b.onLoad(f.bind(a));else b.onLoad(f)}})(window);
(function(){function g(a,d,c,e){var h=b[c],e=e?OT.$.clone(e):{};OT.error("TB.exception :: title: "+h+" ("+c+") msg: "+d);e.partnerId||(e.partnerId=OT.APIKEY);try{f||(f=new OT.Analytics),f.logError(c,"tb.exception",h,{details:d},e),OT.dispatchEvent(new OT.ExceptionEvent(OT.Event.names.EXCEPTION,d,h,c,a,a))}catch(g){OT.error("TB.exception :: Failed to dispatch exception - "+g.toString())}}OT.Error=function(a,b){this.code=a;this.message=b};var b={1E3:"Failed To Load",1004:"Authentication error",1005:"Invalid Session ID",
1006:"Connect Failed",1007:"Connect Rejected",1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Connection Failed",1014:"API Response Failure",1500:"Unable to Publish",1510:"Unable to Signal",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1540:"Unable to record archive",1550:"Unable to play back archive",1560:"Unable to create archive",1570:"Unable to load archive",2E3:"Internal Error",2001:"Embed Failed",
3E3:"Archive load exception",3001:"Archive create exception",3002:"Playback stop exception",3003:"Playback start exception",3004:"Record start exception",3005:"Record stop exception",3006:"Archive load exception",3007:"Session recording in progress",3008:"Archive recording internal failure",4E3:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"},f;OT.handleJsException=function(a,b,c){var c=c||{},e,f=c.session;if(f){if(e={sessionId:f.sessionId},f.connected&&(e.connectionId=f.connection.connectionId),
!c.target)c.target=f}else c.sessionId&&(e={sessionId:c.sessionId},c.target||(c.target=null));g(c.target,a,b,e)};OT.exceptionHandler=function(a,b,c,e,f){var i;a&&((i=OT.components[a])||OT.warn("Could not find the component with component ID "+a));g(i,b,e,f)}})(window);(function(){OT.ConnectionCapabilities=function(g){g.supportsWebRTC=OT.$.castToBoolean(g.supportsWebRTC);this.supportsWebRTC=g.supportsWebRTC}})(window);
(function(){OT.Connection=function(g,b,f,a){var d;this.id=this.connectionId=g;this.creationTime=b?Number(b):null;this.data=f;this.capabilities=new OT.ConnectionCapabilities(a);this.quality=null;OT.$.eventing(this);this.destroy=function(a,b){d=a||"clientDisconnected";!0!==b&&this.dispatchEvent(new OT.DestroyedEvent("destroyed",this,d))}.bind(this);Object.defineProperties(this,{destroyed:{get:function(){return void 0!==d},enumerable:!0},destroyedReason:{get:function(){return d},enumerable:!0}})};OT.Connection.fromHash=
function(g){return new OT.Connection(g.connectionId,g.creationTime,g.data,{supportsWebRTC:g.supportsWebRTC})}})(window);
(function(){var g="hasAudio hasVideo quality name videoDimensions orientation".split(" ");OT.Stream=function(b,f,a,d,c,e,h,i,k,j,l,m,p){var n;this.id=this.streamId=b;this.connection=f;this.name=a;this.data=d;this.type=c||"basic";this.creationTime=e?Number(e):null;this.hasAudio=OT.$.castToBoolean(h,!0);this.hasVideo=OT.$.castToBoolean(i,!0);this.peerId=j;this.quality=l;this.videoDimensions={width:m||640,height:p||480,orientation:k||OT.VideoOrientation.ROTATED_NORMAL};OT.$.eventing(this);this.update=
function(a,b){if(-1===g.indexOf(a))OT.warn('Unknown stream property "'+a+'" was modified to "'+b+'".');else{var c=this[a],d=b;switch(a){case "hasAudio":case "hasVideo":d=OT.$.castToBoolean(d,!0);this[a]=d;break;case "quality":case "name":this[a]=d;break;case "orientation":this.videoDimensions={width:d.width,height:d.height,orientation:d.videoOrientation}}this.dispatchEvent(new OT.StreamUpdatedEvent(this,a,c,d))}};this.destroy=function(a,b){n=a||"clientDisconnected";!0!==b&&this.dispatchEvent(new OT.DestroyedEvent("destroyed",
this,n))};Object.defineProperties(this,{destroyed:{get:function(){return void 0!==n},enumerable:!0},destroyedReason:{get:function(){return n},enumerable:!0}})}})(window);
(function(g){var b=g.webkitRTCPeerConnection||g.mozRTCPeerConnection,f=g.mozRTCSessionDescription||g.RTCSessionDescription,a=g.mozRTCIceCandidate||g.RTCIceCandidate,d=function(a){return function(b){OT.debug("IceCandidateForwarder: Ice Candidate");b.candidate?a(OT.Raptor.Actions.CANDIDATE,b.candidate):OT.debug("IceCandidateForwarder: No more ICE candidates.")}},c=function(){var b=[],c=null;Object.defineProperty(this,"peerConnection",{set:function(a){c=a}});this.process=function(d){d=new a(d.candidate);
c?c.addIceCandidate(d):b.push(d)};this.processPending=function(){for(;b.length;)c.addIceCandidate(b.shift())}},e=function(a){var b=/a=rtpmap:(\d+) CN\/\d+/i,c=[],d,e,a=a.split("\r\n").filter(function(a,f){-1!==a.indexOf("m=audio")&&(d=f);e=a.match(b);return null!==e?(c.push(e[1]),!1):!0});c.length&&d&&(a[d]=a[d].replace(RegExp(c.join("|"),"ig"),"").replace(/\s+/g," "));return a.join("\r\n")},h=function(a,b,c,d){var f=function(a){return function(b){d&&d(a,b)}},h=function(b){b.sdp=e(b.sdp);a.setLocalDescription(b,
function(){c(b)},f("Error while setting LocalDescription"))};-1===b.sdp.indexOf("a=crypto")&&(b.sdp=b.sdp.replace(/^c=IN(.*)$/gmi,"c=IN$1\r\na=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:FakeFakeFakeFakeFakeFakeFakeFakeFakeFake\\r\\n"));-1===b.sdp.indexOf("a=rtcp-fb")&&(b.sdp=b.sdp.replace(/^m=video(.*)$/gmi,"m=video$1\r\na=rtcp-fb:* ccm fir\r\na=rtcp-fb:* nack "));a.setRemoteDescription(b,function(){a.createAnswer(h,f("Error while setting createAnswer"),null,false)},f("Error while setting RemoteDescription"))},
i=function(a,b,c){var d={mandatory:{},optional:[]},f=function(a){return function(b){c&&c(a,b)}};navigator.mozGetUserMedia&&(d.mandatory.MozDontOfferDataChannel=!0);a.createOffer(function(c){c.sdp=e(c.sdp);a.setLocalDescription(c,function(){b(c)},f("Error while setting LocalDescription"))},f("Error while creating Offer"),d)};OT.PeerConnection=function(a){var e,g=new c,m,p,n="new",r=[],q,o=OT.$.now();OT.$.eventing(this);a.iceServers||(a.iceServers=[]);var s=function(a,b){if(r.length)r[0](a,b)}.bind(this),
x=function(){if(!e){try{OT.debug('Creating peer connection config "'+JSON.stringify(a)+'".');e=new b(a,{optional:[{DtlsSrtpKeyAgreement:true}]})}catch(c){OT.error("Failed to create PeerConnection, exception: "+c.message);return null}g.peerConnection=e;e.onicecandidate=d(s);e.onaddstream=B.bind(this);e.onremovestream=z.bind(this);if(e.onsignalingstatechange!==void 0)e.onsignalingstatechange=y.bind(this);else if(e.onstatechange!==void 0)e.onstatechange=y.bind(this)}return e}.bind(this),v=function(){if(g)g.peerConnection=
null;if(e!==null){e=null;this.trigger("close")}},y=function(a){a=typeof a==="string"?a:a.target&&a.target.signalingState?a.target.signalingState:a.target.readyState;OT.debug("PeerConnection.stateChange: "+a);if(a&&a.toLowerCase()!==n){n=a.toLowerCase();OT.debug("PeerConnection.stateChange: "+n);switch(n){case "closed":v.call(this)}}},B=function(a){this.trigger("streamAdded",a.stream)},z=function(a){this.trigger("streamRemoved",a.stream)},w=function(a){a=new f(a.sdp);x();_remoteDescriptionType=a.type;
_remoteDescription=a;h(e,a,function(a){s(OT.Raptor.Actions.ANSWER,a)},function(a,b){C("PeerConnection.offerProcessor "+a+": "+b)})},D=function(){OT.debug("PeerConnection.processSubscribe: Sending offer to subscriber.");x();i(e,function(a){m=a;s(OT.Raptor.Actions.OFFER,m)},function(a,b){C("PeerConnection.suscribeProcessor "+a+": "+b)})},C=function(a){OT.error(a);this.trigger("error",a)}.bind(this);this.addLocalStream=function(a){x();e.addStream(a)};this.disconnect=function(){g=null;if(e){var a=e.signalingState||
e.readyState;a&&a.toLowerCase()!=="closed"&&e.close();v.call(this)}this.off()};this.processMessage=function(a,b){OT.debug("PeerConnection.processMessage: Received "+a+" from "+b.fromAddress);OT.debug(b);switch(a){case OT.Raptor.Actions.SUBSCRIBE:D.call(this,b);break;case OT.Raptor.Actions.OFFER:w.call(this,b);break;case OT.Raptor.Actions.ANSWER:if(b.sdp){p=new f(b.sdp);_remoteDescriptionType=p.type;_remoteDescription=p;e.setRemoteDescription(p);g.processPending()}else OT.error("PeerConnection.processMessage: Weird message, no SDP.");
break;case OT.Raptor.Actions.CANDIDATE:g.process(b);break;default:OT.debug("PeerConnection.processMessage: Received an unexpected message of type "+a+" from "+b.fromAddress+": "+JSON.stringify(b))}return this};this.registerMessageDelegate=function(a){return r.push(a)};this.unregisterMessageDelegate=function(a){a=r.indexOf(a);a!==-1&&r.splice(a,1);return r.length};this.getStats=function(a,b){if(q==true)OT.warn("PeerConnection.getStats: Already getting the stats!");else{q=true;var c=OT.$.now(),d=(c-
a.timeStamp)/1E3;a.timeStamp=c;var f={},h=function(c){if(c.result)for(var c=c.result(),e=0;e<c.length;e++){var h=c[e];if(h.stat){var g;g=h;var i=a.videoBytesTransferred||0;if(g.stat("googFrameHeightSent")){a.videoBytesTransferred=g.stat("bytesSent");g=Math.round((a.videoBytesTransferred-i)*8/d)}else if(g.stat("googFrameHeightReceived")){a.videoBytesTransferred=g.stat("bytesReceived");g=Math.round((a.videoBytesTransferred-i)*8/d)}else g=NaN;isNaN(g)||(f.avgVideoBitrate=g);g=a.audioBytesTransferred||
0;if(h.stat("audioInputLevel")){a.audioBytesTransferred=h.stat("bytesSent");h=Math.round((a.audioBytesTransferred-g)*8/d)}else if(h.stat("audioOutputLevel")){a.audioBytesTransferred=h.stat("bytesReceived");h=Math.round((a.audioBytesTransferred-g)*8/d)}else h=NaN;isNaN(h)||(f.avgAudioBitrate=h)}}q=false;b(f)};f.duration=Math.round(c-o);if(e&&e.getStats)e.getStats(h);else{q=false;b(f)}}};Object.defineProperty(this,"remoteStreams",{get:function(){var a;if(e){if(e.getRemoteStreams)a=e.getRemoteStreams();
else if(e.remoteStreams)a=e.remoteStreams;else throw Error("Invalid Peer Connection object implements no method for retrieving remote streams");a=Array.prototype.slice.call(a)}else a=[];return a}})}})(window);(function(){var g={};OT.PeerConnections={add:function(b,f,a){b=b.id+"_"+f.id;(f=g[b])||(f=g[b]={count:0,pc:new OT.PeerConnection(a)});f.count+=1;return f.pc},remove:function(b,f){var a=b.id+"_"+f.id,d=g[a];d&&(d.count-=1,0===d.count&&(d.pc.disconnect(),delete g[a]))}}})(window);
(function(){OT.PublisherPeerConnection=function(g,b,f,a){var d,c=!1,e=function(){this.destroy();this.trigger("disconnected",this)},h=function(a){this.trigger("error",null,a,this);this.destroy()},i=function(a,d){if(!c&&(a===OT.Raptor.Actions.CANDIDATE||a===OT.Raptor.Actions.OFFER||a===OT.Raptor.Actions.ANSWER||a===OT.Raptor.Actions.PRANSWER))c=-1!==(a===OT.Raptor.Actions.CANDIDATE?d.candidate:d.sdp).indexOf("typ relay");switch(a){case OT.Raptor.Actions.ANSWER:case OT.Raptor.Actions.PRANSWER:b._.jsepAnswer(g.id,
f,d);break;case OT.Raptor.Actions.OFFER:this.trigger("connected");b._.jsepOffer(g.id,f,d);break;case OT.Raptor.Actions.CANDIDATE:b._.jsepCandidate(g.id,f,d)}}.bind(this);OT.$.eventing(this);this.destroy=function(){d&&OT.PeerConnections.remove(g,f);d=null;this.off()};this.processMessage=function(a,b){d.processMessage(a,b)};this.getStats=function(a,b){d.getStats(a,b)};this.init=function(){var k=b.sessionInfo.iceServers.map(function(a){a=OT.$.clone(a);"turn:"===a.url.trim().substr(0,5)&&(a.username=
b.id+"."+b.connection.id+"."+f.id);return a});d=OT.PeerConnections.add(g,f,{iceServers:k});d.on({close:e,error:h},this);d.registerMessageDelegate(i);d.addLocalStream(a);Object.defineProperty(this,"remoteConnection",{value:g});Object.defineProperty(this,"hasRelayCandidates",{get:function(){return c}})}}})(window);
(function(){OT.SubscriberPeerConnection=function(g,b,f,a){var d,c=!1,e=function(){this.destroy();this.trigger("disconnected",this)},h=function(a){this.trigger("remoteStreamAdded",a,this)},i=function(a){this.trigger("remoteStreamRemoved",a,this)},k=function(a){this.trigger("error",null,a,this)},j=function(a,d){if(!c&&(a===OT.Raptor.Actions.CANDIDATE||a===OT.Raptor.Actions.OFFER||a===OT.Raptor.Actions.ANSWER||a===OT.Raptor.Actions.PRANSWER))c=-1!==(a===OT.Raptor.Actions.CANDIDATE?d.candidate:d.sdp).indexOf("typ relay");
switch(a){case OT.Raptor.Actions.ANSWER:case OT.Raptor.Actions.PRANSWER:this.trigger("connected");b._.jsepAnswer(g.id,f,d);break;case OT.Raptor.Actions.OFFER:b._.jsepOffer(g.id,f,d);break;case OT.Raptor.Actions.CANDIDATE:b._.jsepCandidate(g.id,f,d)}}.bind(this),l=function(a){var b="get"+(a?"Video":"Audio")+"Tracks";return function(a){var c=d.remoteStreams,e;if(0!==c.length&&c[0][b])for(var f=0,h=c.length;f<h;++f){e=c[f];e=e[b]();for(var g=0,i=e.length;g<i;++g)e[g].enabled=a}}};OT.$.eventing(this);
this.destroy=function(){d&&(0===d.unregisterMessageDelegate(j)&&(b&&(b.connected&&f&&!f.destroyed)&&b._.jsepUnsubscribe(f),this.subscribeToAudio(!1)),OT.PeerConnections.remove(g,f.streamId));d=null;this.off()};this.processMessage=function(a,b){d.processMessage(a,b)};this.getStats=function(a,b){d.getStats(a,b)};this.subscribeToAudio=l(!1);this.subscribeToVideo=l(!0);Object.defineProperty(this,"hasRelayCandidates",{get:function(){return c}});this.init=function(){var c=b.sessionInfo.iceServers.map(function(a){a=
OT.$.clone(a);"turn:"===a.url.trim().substr(0,5)&&(a.username=b.id+"."+b.connection.id+"."+f.id);return a});d=OT.PeerConnections.add(g,f.streamId,{iceServers:c});d.on({close:e,streamAdded:h,streamRemoved:i,error:k},this);c=d.registerMessageDelegate(j);0<d.remoteStreams.length?d.remoteStreams.forEach(h,this):1===c&&b._.jsepSubscribe(f,a.subscribeToVideo,a.subscribeToAudio)}}})(window);
(function(){OT.Chrome=function(g){var b={},f=function(a,d){d.parent=this;d.appendTo(g.parent);b[a]=d;Object.defineProperty(this,a,{get:function(){return b[a]}})};g.parent&&(OT.$.eventing(this),this.destroy=function(){this.off();this.hide();for(var a in b)b[a].destroy()},this.show=function(){for(var a in b)b[a].show()},this.hide=function(){for(var a in b)b[a].hide()},this.set=function(a,b){if("string"===typeof a&&b)f.call(this,a,b);else for(var c in a)a.hasOwnProperty(c)&&f.call(this,c,a[c]);return this})}})(window);
(function(){OT.Chrome.Behaviour||(OT.Chrome.Behaviour={});OT.Chrome.Behaviour.Widget=function(g,b){var f=b||{},a,d;g.setDisplayMode=function(b){b=b||"auto";if(a!==b){OT.$.removeClass(this.domElement,"OT_mode-"+a);OT.$.addClass(this.domElement,"OT_mode-"+b);d=a;a=b}};g.show=function(){this.setDisplayMode(d);if(f.onShow)f.onShow();return this};g.hide=function(){this.setDisplayMode("off");if(f.onHide)f.onHide();return this};g.destroy=function(){if(f.onDestroy)f.onDestroy(this.domElement);this.domElement&&
OT.$.removeElement(this.domElement);return g};g.appendTo=function(a){this.domElement=OT.$.createElement(f.nodeName||"div",f.htmlAttributes,f.htmlContent);if(f.onCreate)f.onCreate(this.domElement);if(f.mode!="auto")g.setDisplayMode(f.mode);else{g.setDisplayMode("on");setTimeout(function(){g.setDisplayMode(f.mode)},2E3)}a.appendChild(this.domElement);return g}}})(window);
(function(){OT.Chrome.NamePanel=function(g){var b=g.name;if(!b||""===b.trim().length)b=null,g.mode="off";var f;Object.defineProperty(this,"domElement",{get:function(){return f},set:function(a){f=a}});OT.Chrome.Behaviour.Widget(this,{mode:g.mode,nodeName:"h1",htmlContent:b,htmlAttributes:{className:"OT_name"}});Object.defineProperty(this,"name",{set:function(a){b||this.setDisplayMode("auto");b=a;f.innerHTML=b}.bind(this)})}})(window);
(function(){OT.Chrome.MuteButton=function(g){var b,f=g.muted||!1,a;Object.defineProperty(this,"domElement",{get:function(){return a},set:function(b){a=b}});var d=function(){(f=!f)?(OT.$.addClass(a,"OT_active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"OT_active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:g.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:f?"OT_mute OT_active":"OT_mute"},onCreate:function(a){b=d.bind(this);
a.addEventListener("click",b,!1)}.bind(this),onDestroy:function(a){b=null;a.removeEventListener("click",b,!1)}.bind(this)})}})(window);
(function(){OT.Chrome.MicVolume=function(g){var b,f=g.muted||!1,a;Object.defineProperty(this,"domElement",{get:function(){return a},set:function(b){a=b}});var d=function(){(f=!f)?(OT.$.addClass(a,"active"),this.parent.trigger("muted",this)):(OT.$.removeClass(a,"active"),this.parent.trigger("unmuted",this));return!1};OT.Chrome.Behaviour.Widget(this,{mode:g.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:"OT_mic-volume"},onCreate:function(a){b=d.bind(this);a.addEventListener("click",
b,!1)}.bind(this),onDestroy:function(a){b=null;a.removeEventListener("click",b,!1)}.bind(this)})}})(window);
(function(){OT.Chrome.SettingsPanelButton=function(g){var b,f=function(){this.parent.trigger("SettingsPanel:open",this);return!1},a;Object.defineProperty(this,"domElement",{get:function(){return a},set:function(b){a=b}});OT.Chrome.Behaviour.Widget(this,{mode:g.mode,nodeName:"button",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:function(a){b=f.bind(this);a.addEventListener("click",b,!1)}.bind(this),onDestroy:function(a){b=null;a.removeEventListener("click",b,!1)}.bind(this)})}})(window);
(function(){OT.Chrome.SettingsPanel=function(g){if(g.stream){var b=g.stream,f;Object.defineProperty(this,"domElement",{get:function(){return f},set:function(a){f=a}});var a=function(){var a=b.getVideoTracks().length?b.getVideoTracks()[0].label:"None",e=b.getAudioTracks().length?b.getAudioTracks()[0].label:"None";f.innerHTML="<dl>                                        <dt>Cam</dt>                                        <dd>"+a+"</dd>                                        <dt>Mic</dt>                                        <dd>"+
e+"</dd>                                    </dl>";a=OT.$.createButton("Close",{className:"OT_close"},{click:d.bind(this)});f.appendChild(a)},d=function(){this.parent.trigger("SettingsPanel:close",this);return!1};OT.Chrome.Behaviour.Widget(this,{mode:g.mode,nodeName:"section",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:a.bind(this),onShow:function(){a.call(this)}.bind(this)})}}})(window);
(function(){OT.Chrome.OpenTokButton=function(g){var b;this.__defineGetter__("domElement",function(){return b});this.__defineSetter__("domElement",function(f){b=f});OT.Chrome.Behaviour.Widget(this,{mode:g?g.mode:null,nodeName:"span",htmlContent:"OpenTok",htmlAttributes:{className:"OT_opentok"}})}})(window);
(function(){OT.StylableComponent=function(b,f){if(!b.trigger)throw Error("OT.StylableComponent is dependent on the mixin OT.$.eventing. Ensure that this is included in the object before StylableComponent.");var a=new g(f,function(a,c,e){e?b.trigger("styleValueChanged",a,c,e):b.trigger("styleValueChanged",a,c)});b.getStyle=function(b){return a.get(b)};b.setStyle=function(b,c,e){"string"!==typeof b?a.setAll(b,e):a.set(b,c);return this}};var g=function(b,f){var a="showMicButton showSpeakerButton showSettingsButton showCameraToggleButton nameDisplayMode buttonDisplayMode showSaveButton showRecordButton showRecordStopButton showReRecordButton showPauseButton showPlayButton showPlayStopButton showStopButton backgroundImageURI showControlPanel showRecordCounter showPlayCounter showControlBar showPreviewTime".split(" "),
d={buttonDisplayMode:["auto","off","on"],nameDisplayMode:["auto","off","on"],showSettingsButton:[!0,!1],showMicButton:[!0,!1],showCameraToggleButton:[!0,!1],showSaveButton:[!0,!1],backgroundImageURI:null,showControlBar:[!0,!1],showPlayCounter:[!0,!1],showRecordCounter:[!0,!1],showPreviewTime:[!0,!1]},c={},e=function(a,b){return"backgroundImageURI"===a||d.hasOwnProperty(a)&&-1!==d[a].indexOf(b)},h=function(a){switch(a){case "true":return!0;case "false":return!1;default:return a}};this.getAll=function(){var b=
OT.$.clone(c),d;for(d in b)0>a.indexOf(d)&&delete b[d];return b};this.get=function(a){return a?c[a]:this.getAll()};this.setAll=function(a,b){var d,g,m;for(m in a)g=h(a[m]),e(m,g)?(d=c[m],g!==d&&(c[m]=g,b||f(m,g,d))):OT.warn("Style.setAll::Invalid style property passed "+m+" : "+g);return this};this.set=function(a,b){OT.debug("Publisher.setStyle: "+a.toString());var d=h(b),g;if(!e(a,d))return OT.warn("Style.set::Invalid style property passed "+a+" : "+d),this;g=c[a];d!==g&&(c[a]=d,f(a,b,g));return this};
b&&this.setAll(b,!0)}})(window);(function(){OT.Microphone=function(g,b){var f,a=50;Object.defineProperty(this,"muted",{get:function(){return f},set:function(a){if(f!==a){f=a;for(var a=g.getAudioTracks(),b=0,e=a.length;b<e;++b)a[b].enabled=!f}}});Object.defineProperty(this,"gain",{get:function(){return a},set:function(b){OT.warn("OT.Microphone.gain IS NOT YET IMPLEMENTED");a=b}});this.muted=void 0!==b?!0===b:g.getAudioTracks().length?!g.getAudioTracks()[0].enabled:!1}})(window);
(function(){OT.generateSimpleStateMachine=function(g,b,f){var a=b.slice(),d=OT.$.clone(f);return function(b){function e(a,d){b({message:a,newState:d,currentState:f,previousState:i})}var f=g,i=null;this.set=function(b){var c;-1!==a.indexOf(b)?d[f]&&-1!==d[f].indexOf(b)?c=!0:(e("'"+f+"' cannot transition to '"+b+"'",b),c=!1):(e("'"+b+"' is not a valid state",b),c=!1);c&&(i=f,f=b)};Object.defineProperties(this,{current:{get:function(){return f}},subscribing:{get:function(){return"Subscribing"===f}}})}}})(window);
(function(){OT.SubscribingState=OT.generateSimpleStateMachine("NotSubscribing","NotSubscribing Init ConnectingToPeer BindingRemoteStream Subscribing Failed".split(" "),{NotSubscribing:["NotSubscribing","Init"],Init:["NotSubscribing","ConnectingToPeer","BindingRemoteStream"],ConnectingToPeer:["NotSubscribing","BindingRemoteStream","Failed"],BindingRemoteStream:["NotSubscribing","Subscribing","Failed"],Subscribing:["NotSubscribing","Failed"],Failed:[]});Object.defineProperty(OT.SubscribingState.prototype,
"attemptingToSubscribe",{get:function(){return-1!==["Init","ConnectingToPeer","BindingRemoteStream"].indexOf(this.current)}})})(window);
(function(){OT.PublishingState=OT.generateSimpleStateMachine("NotPublishing","NotPublishing GetUserMedia BindingMedia MediaBound PublishingToSession Publishing Failed".split(" "),{NotPublishing:["NotPublishing","GetUserMedia"],GetUserMedia:["BindingMedia","Failed","NotPublishing"],BindingMedia:["MediaBound","Failed","NotPublishing"],MediaBound:["NotPublishing","PublishingToSession","Failed"],PublishingToSession:["NotPublishing","Publishing","Failed"],Publishing:["NotPublishing","MediaBound","Failed"],
Failed:[]});Object.defineProperties(OT.PublishingState.prototype,{attemptingToPublish:{get:function(){return-1!==["GetUserMedia","BindingMedia","MediaBound","PublishingToSession"].indexOf(this.current)}},publishing:{get:function(){return"Publishing"===this.current}}})})(window);
(function(){var g={audio:!0,video:!0};OT.Publisher=function(){if(OT.checkSystemRequirements()){var b=OT.Publisher.nextId(),f,a,d,c,e,h,i={},k=!1,j,l,m,p,n=new OT.Analytics,r={},q={timeStamp:OT.$.now()},o;OT.$.eventing(this);OT.StylableComponent(this,{showMicButton:!0,showSettingsButton:!0,showCameraToggleButton:!0,nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var s=function(a,d,e,f){n.logEvent({action:a,variation:d,payload_type:e,payload:f,session_id:h?h.sessionId:null,
connection_id:h&&h.connected?h.connection.connectionId:null,partner_id:h?h.apiKey:OT.APIKEY,streamId:c?c.id:null,widget_id:b,widget_type:"Publisher"})},x=function(a){var d={widget_type:"Publisher",stream_type:"WebRTC",sessionId:h?h.sessionId:null,connectionId:h&&h.connected?h.connection.connectionId:null,partnerId:h?h.apiKey:OT.APIKEY,streamId:c?c.id:null,widgetId:b,version:OT.properties.version,media_server_name:h?h.sessionInfo.messagingServer:null,p2pFlag:h?h.sessionInfo.p2pEnabled:!1,duration:(new Date).getTime()-
l.getTime(),remote_connection_id:a};i[a].getStats(q,function(a){if(a)for(stat_index in a)d[stat_index]=a[stat_index];n.logQOS(d)})},v=function(){OT.debug("OT.Publisher.onLoaded");s("publish","Success","streamType","WebRTC");o.set("MediaBound");a.loading=!1;k=!0;p=(new OT.Chrome({parent:a.domElement})).set({name:new OT.Chrome.NamePanel({name:j.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new OT.Chrome.MuteButton({muted:!1===j.publishAudio,mode:K.call(this,this.getStyle("showMicButton"))}),
opentokButton:new OT.Chrome.OpenTokButton}).on({muted:this.publishAudio.bind(this,!1),unmuted:this.publishAudio.bind(this,!0)});this.trigger("initSuccess",this);this.trigger("loaded",this)},y=function(a){s("publish","Failure","reason","Publisher PeerConnection Error: "+a);o.set("Failed");this.trigger("publishError","Publisher PeerConnection Error: "+a);OT.handleJsException("Publisher PeerConnection Error: "+a,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:h,target:this})},B=function(b){OT.debug("OT.Publisher.onStreamAvailable");
o.set("BindingMedia");e&&(e.stop(),e=null);e=b;m=new OT.Microphone(e,!j.publishAudio);this.publishVideo(j.publishVideo);this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_ALLOWED,!1));d=new OT.VideoElement({attributes:{muted:!0}});d.on({streamBound:v,loadError:y,error:A},this).bindToStream(e);a.video=d},z=function(b){OT.error("OT.Publisher.onStreamAvailableError "+b.name+": "+b.message);o.set("Failed");this.trigger("publishError",b.message);a&&a.destroy();s("publish","Failure","reason","Publisher failed to access camera/mic: "+
b.message);OT.handleJsException("Publisher failed to access camera/mic: "+b.message,2E3,{session:h,target:this})},w=function(b){OT.error("OT.Publisher.onStreamAvailableError Permission Denied");o.set("Failed");this.trigger("publishError",b.message);s("publish","Failure","reason","Publisher Access Denied: Permission Denied");var c=new OT.Event(OT.Event.names.ACCESS_DENIED);this.dispatchEvent(c,function(){!c.isDefaultPrevented()&&a&&a.destroy()})},D=function(){s("accessDialog","Opened","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_OPENED,
!1))},C=function(){s("accessDialog","Closed","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_CLOSED,!1))},A=function(a,b){OT.error("OT.Publisher.onVideoError");var c=b+(a?" ("+a+")":"");s("stream",null,"reason","Publisher while playing stream: "+c);o.set("Failed");o.attemptingToPublish?this.trigger("publishError",c):this.trigger("error",c);OT.handleJsException("Publisher error playing stream: "+c,2E3,{session:h,target:this})},E=function(a){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");
this.cleanupSubscriber(a.remoteConnection.id)},I=function(a,b,c){s("publish","Failure","reason|hasRelayCandidates",["Publisher PeerConnection with connection "+c.remoteConnection.id+" failed: "+b,c.hasRelayCandidates].join("|"));OT.handleJsException("Publisher PeerConnection Error: "+b,2E3,{session:h,target:this});clearInterval(r[c.remoteConnection.id]);delete r[c.remoteConnection.id];delete i[c.remoteConnection.id]},J=function(a){var b=i[a.id];if(!b){var d=OT.$.now();s("createPeerConnection","Attempt",
"","");a.on("destroyed",this.cleanupSubscriber.bind(this,a.id));b=i[a.id]=new OT.PublisherPeerConnection(a,h,c,e);b.on({connected:function(){s("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(OT.$.now()-d,10),b.hasRelayCandidates].join("|"));r[a.id]=setInterval(function(){x(a.id)},3E4)},disconnected:E,error:I},this);b.init()}return b},K=function(a){if(!1===a)return"off";a=this.getStyle("buttonDisplayMode");return!1===a?"on":a},F=function(){p&&(p.destroy(),p=null);this.disconnect();
m=null;d&&(d.destroy(),d=null);e&&(e.stop(),e=null);a&&(a.destroy(),a=null);this.session&&this._.unpublishFromSession(this.session);for(var b in r)clearInterval(r[b]),delete r[b];c=f=null;k=!1;_properties=h=null;o.set("NotPublishing")}.bind(this);this.publish=function(b,c){OT.debug("OT.Publisher: publish");(o.attemptingToPublish||o.publishing)&&F();o.set("GetUserMedia");j=OT.$.defaults(c||{},{publishAudio:!0,publishVideo:!0,mirror:!0});j.constraints=OT.$.defaults(j.constraints||{},g);j.style&&this.setStyle(j.style,
null,!0);j.name&&(j.name=j.name.toString());j.classNames="OT_root OT_publisher";OT.onLoad(function(){a=new OT.WidgetView(b,j);f=a.domId;OT.$.getUserMedia(j.constraints,B.bind(this),z.bind(this),D.bind(this),C.bind(this),w.bind(this))},this);return this};this.publishAudio=function(a){j.publishAudio=a;m&&(m.muted=!a);h&&c&&h._.modifyStream(c.streamId,"hasAudio",a);return this};this.publishVideo=function(b){var d=j.publishVideo;j.publishVideo=b;h&&(c&&j.publishVideo!==d)&&h._.modifyStream(c.streamId,
"hasVideo",b);if(e)for(var d=e.getVideoTracks(),f=0,g=d.length;f<g;++f)d[f].enabled=b;a&&(a.showPoster=!b);return this};this.recordQOS=function(){for(var a in i)x(a)};this.destroy=function(a,b){F();!0!==b&&this.dispatchEvent(new OT.DestroyedEvent(OT.Event.names.PUBLISHER_DESTROYED,this,a),this.off.bind(this));return this};this.disconnect=function(){for(var a in i)this.cleanupSubscriber(a)};this.cleanupSubscriber=function(a){var b=i[a];clearInterval(r[a]);delete r[a];b&&(b.destroy(),delete i[a],s("disconnect",
"PeerConnection","subscriberConnection",a))};this.processMessage=function(a,b,c){OT.debug("OT.Publisher.processMessage: Received "+a+" from "+b.id);OT.debug(c);switch(a){case OT.Raptor.Actions.UNSUBSCRIBE:this.cleanupSubscriber(b.id);break;default:J.call(this,b).processMessage(a,c)}};this.getImgData=function(){return!k?(OT.error("OT.Publisher.getImgData: Cannot getImgData before the Publisher is publishing."),null):d.imgData};this._={publishToSession:function(a){this.session=a;var b=function(){this.session&&
(o.set("PublishingToSession"),a._.createStream(this.guid,j&&j.name?j.name:"",OT.VideoOrientation.ROTATED_NORMAL,d.videoWidth,d.videoHeight,j.publishAudio,j.publishVideo))};if(k)b.call(this);else this.on("initSuccess",b,this);s("publish","Attempt","streamType","WebRTC");return this}.bind(this),unpublishFromSession:function(a){if(!this.session||a.id!==this.session.id)return OT.warn("The publisher "+this.guid+" is trying to unpublish from a session "+a.id+" it is not attached to"),this;a.connected&&
this.stream&&a._.destroyStream(this.stream.id);this.disconnect();this.session=null;o.set("MediaBound");s("unpublish","Success","sessionId",a.id);return this}.bind(this),streamRegisteredHandler:function(a){this.stream=a;this.stream.on("destroyed",this.disconnect,this);a=b;b=OT.Publisher.nextId();a&&this.trigger("idUpdated",a,b);o.set("Publishing");l=new Date;this.trigger("publishSuccess")}.bind(this)};this.detectDevices=function(){OT.warn("Fixme: Haven't implemented detectDevices")};this.detectMicActivity=
function(){OT.warn("Fixme: Haven't implemented detectMicActivity")};this.getEchoCancellationMode=function(){OT.warn("Fixme: Haven't implemented getEchoCancellationMode");return"fullDuplex"};this.setMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented setMicrophoneGain")};this.getMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented getMicrophoneGain");return 0.5};this.setCamera=function(){OT.warn("Fixme: Haven't implemented setCamera")};this.setMicrophone=function(){OT.warn("Fixme: Haven't implemented setMicrophone")};
Object.defineProperties(this,{id:{get:function(){return f},enumerable:!0},guid:{get:function(){return b},enumerable:!0},stream:{get:function(){return c},set:function(a){c=a},enumerable:!0},streamId:{get:function(){return!c?null:c.id},enumerable:!0},targetElement:{get:function(){return d.domElement}},domId:{get:function(){return f}},session:{get:function(){return h},set:function(a){h=a},enumerable:!0},isWebRTC:{get:function(){return!0}},loading:{get:function(){return a&&a.loading}}});Object.defineProperty(this._,
"webRtcStream",{get:function(){return e}});this.on("styleValueChanged",function(a,b){if(p)switch(a){case "nameDisplayMode":p.name.setDisplayMode(b)}},this);o=new OT.PublishingState(function(a){OT.error("Publisher State Change Failed: ",a.message);OT.debug(a)})}else OT.upgradeSystemRequirements()};OT.Publisher.nextId=OT.$.uuid})(window);
(function(){OT.Subscriber=function(g,b){var f=OT.$.uuid(),a=g||f,d,c,e,h,i,k,j=b.session,l,m,p,n=OT.$.clone(b),r=new OT.Analytics,q=50,o,s,x={timeStamp:OT.$.now()};if(j){OT.$.eventing(this);OT.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var v=function(a,b,c,d){r.logEvent({action:a,variation:b,payload_type:c,payload:d,stream_id:h?h.id:null,session_id:j?j.sessionId:null,connection_id:j&&j.connected?j.connection.connectionId:null,partner_id:j&&j.connected?
j.sessionInfo.partnerId:null,widget_id:f,widget_type:"Subscriber"})},y=function(){if(o.subscribing&&j&&j.connected){var a={widget_type:"Subscriber",stream_type:"WebRTC",session_id:j?j.sessionId:null,connectionId:j?j.connection.connectionId:null,media_server_name:j?j.sessionInfo.messagingServer:null,p2pFlag:j?j.sessionInfo.p2pEnabled:!1,partner_id:j?j.apiKey:null,stream_id:h.id,widget_id:f,version:OT.properties.version,duration:parseInt(OT.$.now()-l,10),remote_connection_id:h.connection.connectionId};
k.getStats(x,function(b){if(b)for(stat_index in b)a[stat_index]=b[stat_index];r.logQOS(a)})}},B=function(){!o.subscribing&&c&&(OT.debug("OT.Subscriber.onLoaded"),o.set("Subscribing"),l=OT.$.now(),v("createPeerConnection","Success","pcc|hasRelayCandidates",[parseInt(l-m,10),k&&k.hasRelayCandidates].join("|")),p=setInterval(y,3E4),s&&(s=null,this.subscribeToVideo(!1)),d.loading=!1,E.call(this),this.trigger("subscribeSuccess",this),this.trigger("loaded",this),v("subscribe","Success","streamId",h.id))},
z=function(){OT.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection");o.attemptingToSubscribe?(o.set("Failed"),this.trigger("subscribeError","ClientDisconnected")):o.subscribing&&o.set("Failed");this.disconnect()},w=function(a,b){o.attemptingToSubscribe?(v("createPeerConnection","Failure","reason|hasRelayCandidates",["Subscriber PeerConnection Error: "+b,k&&k.hasRelayCandidates].join("|")),o.set("Failed"),this.trigger("subscribeError",b)):o.subscribing&&(o.set("Failed"),
this.trigger("error",b));this.disconnect();v("subscribe","Failure","reason","Subscriber PeerConnection Error: "+b);OT.handleJsException("Subscriber PeerConnection Error: "+b,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:j,target:this});d&&d.addError(b)},D=function(a){OT.debug("OT.Subscriber.onRemoteStreamAdded");o.set("BindingRemoteStream");this.subscribeToAudio(n.subscribeToAudio);var b=s;this.subscribeToVideo(n.subscribeToVideo);s=b;b=new OT.VideoElement;b.setAudioVolume(q);b.on({streamBound:B,
loadError:w,error:w},this);b.bindToStream(a);c=d.video=b;c.orientation={width:h.videoDimensions.width,height:h.videoDimensions.height,videoOrientation:h.videoDimensions.orientation};v("createPeerConnection","StreamAdded","","");this.trigger("streamAdded",this)},C=function(a){OT.debug("OT.Subscriber.onStreamRemoved");c.stream==a&&(c.destroy(),c=null);this.trigger("streamRemoved",this)},A=function(a){switch(a.changedProperty){case "orientation":c.orientation={width:h.videoDimensions.width,height:h.videoDimensions.height,
videoOrientation:h.videoDimensions.orientation};break;case "hasVideo":d&&(d.showPoster=!(h.hasVideo&&n.subscribeToVideo))}},E=function(){e=(new OT.Chrome({parent:d.domElement})).set({name:new OT.Chrome.NamePanel({name:n.name,mode:this.getStyle("nameDisplayMode")}),opentokButton:new OT.Chrome.OpenTokButton}).on({muted:function(){},unmuted:function(){}})};this.recordQOS=function(){y()};this.subscribe=function(b){OT.debug("OT.Subscriber: subscribe to "+b.id);if(o.subscribing)return OT.error("OT.Subscriber.Subscribe: Cannot subscribe, already subscribing."),
!1;o.set("Init");if(!b)return OT.error("OT.Subscriber: No stream parameter."),!1;if(h)return OT.error("OT.Subscriber: Already subscribed"),!1;h=b;h.on({updated:A,destroyed:this.disconnect},this);i=b.connection.connectionId;n.name=h.name;n.classNames="OT_root OT_subscriber";n.style&&this.setStyle(n.style,null,!0);n.audioVolume&&this.setAudioVolume(n.audioVolume);n.subscribeToAudio=OT.$.castToBoolean(n.subscribeToAudio,!0);n.subscribeToVideo=OT.$.castToBoolean(n.subscribeToVideo,!0);d=new OT.WidgetView(g,
n);a=d.domId;!n.subscribeToVideo&&"Chrome"==OT.$.browser()&&(s=!0,n.subscribeToVideo=!0);m=OT.$.now();h.connection.id!==j.connection.id?(v("createPeerConnection","Attempt","",""),o.set("ConnectingToPeer"),k=new OT.SubscriberPeerConnection(h.connection,j,h,n),k.on({disconnected:z,error:w,remoteStreamAdded:D,remoteStreamRemoved:C},this),k.init()):(v("createPeerConnection","Attempt","",""),D.call(this,j.getPublisherForStream(h)._.webRtcStream));v("subscribe","Attempt","streamId",h.id);return this};this.destroy=
function(b,c){clearInterval(p);p=null;this.disconnect();e&&(e.destroy(),e=null);d&&(d.destroy(),d=null);h&&!h.destroyed&&v("unsubscribe",null,"streamId",h.id);n=j=h=a=null;!0!==c&&this.dispatchEvent(new OT.DestroyedEvent(OT.Event.names.SUBSCRIBER_DESTROYED,this,b),this.off.bind(this));return this};this.disconnect=function(){o.set("NotSubscribing");c&&(c.destroy(),c=null);k&&(k.destroy(),k=null,v("disconnect","PeerConnection","streamId",h.id))};this.processMessage=function(a,b,c){OT.debug("OT.Subscriber.processMessage: Received "+
a+" message from "+b.id);OT.debug(c);i!=b.id&&(i=b.id);k&&k.processMessage(a,c)};this.updateQuality=function(){this.subscribeToVideo(!1);this.dispatchEvent(new OT.Event("videoDisabled"))};this.getImgData=function(){return!this.subscribing?(OT.error("OT.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing."),null):c.imgData};this.setAudioVolume=function(a){a=parseInt(a,10);if(isNaN(a))return OT.error("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),
this;q=Math.max(0,Math.min(100,a));q!=a&&OT.warn("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100");c&&c.setAudioVolume(q);return this};this.getAudioVolume=function(){return c?c.getAudioVolume():q};this.subscribeToAudio=function(a){a=OT.$.castToBoolean(a,!0);k&&(k.subscribeToAudio(a),j&&(h&&a!==n.subscribeToAudio)&&j._.modifySubscriber(this,"hasAudio",a));n.subscribeToAudio=a;return this};this.subscribeToVideo=function(a){if(s&&!0==a)s=!1;else return a=OT.$.castToBoolean(a,
!0),d&&(d.showPoster=!(a&&h.hasVideo),a&&d.video&&(d.loading=a,d.video.whenTimeIncrements(function(){d.loading=!1},this))),k&&(k.subscribeToVideo(a),j&&(h&&a!==n.subscribeToVideo)&&j._.modifySubscriber(this,"hasVideo",a)),n.subscribeToVideo=a,this};Object.defineProperties(this,{id:{get:function(){return a},enumerable:!0},widgetId:{get:function(){return f}},stream:{get:function(){return h},enumerable:!0},streamId:{get:function(){return!h?null:h.id},enumerable:!0},targetElement:{get:function(){return c?
c.domElement:null}},subscribing:{get:function(){return o.subscribing},enumerable:!0},isWebRTC:{get:function(){return!0}},loading:{get:function(){return d&&d.loading}},session:{get:function(){return j}}});this.on("styleValueChanged",function(a,b){if(e)switch(a){case "nameDisplayMode":e.name.setDisplayMode(b)}},this);o=new OT.SubscribingState(function(a){OT.error("Subscriber State Change Failed: ",a.message);OT.debug(a)})}else OT.handleJsException("Subscriber must be passed a session option",2E3,{session:j,
target:this})}})(window);
(function(){OT.SessionInfo=function(b){var f=null;this.sessionStatus=this.partnerId=this.sessionId=null;this.p2pEnabled=!1;this.iceServers=this.messagingServer=null;OT.log("SessionInfo Response:");OT.log(b);b&&(b.documentElement&&null!==b.documentElement.firstElementChild)&&(f=b.documentElement.firstElementChild);b=f.firstElementChild;do switch(b.localName){case "session_id":this.sessionId=b.textContent;break;case "partner_id":this.partnerId=b.textContent;break;case "session_status":this.sessionStatus=b.textContent;
break;case "messaging_server_url":this.messagingServer=b.textContent;break;case "ice_servers":this.iceServers=normaliseIceServers(parseIceServersXml(b.childNodes));0===this.iceServers.length&&(OT.warn("SessionInfo contained not ICE Servers, using the default"),this.iceServers=[{url:"stun:stun.l.google.com:19302"}]);break;case "properties":if(f=b.firstElementChild){do if("p2p"===f.localName&&null!==f.firstElementChild){this.p2pEnabled="enabled"===f.firstElementChild.textContent;break}while(f=f.nextElementSibling)
}}while(b=b.nextElementSibling)};OT.SessionInfo.get=function(b,f,a){var d=OT.properties.apiURL+"/session/"+b.id+"?extended=true",c=OT.$.now();b.logEvent("getSessionInfo","Attempt","api_url",OT.properties.apiURL);OT.$.getXML(d,{headers:{"X-TB-TOKEN-AUTH":b.token,"X-TB-VERSION":1},success:function(d){b.logEvent("Instrumentation",null,"gsi",OT.$.now()-c);var g=parseErrorFromXMLDocument(d);!1===g?onGetResponseCallback(b,f,d):onGetErrorCallback(b,a,g)},error:function(c){onGetErrorCallback(b,a,parseErrorFromXMLDocument(c.target.responseXML))}})};
var g={};g["404"]=OT.ExceptionCodes.INVALID_SESSION_ID;g["403"]=OT.ExceptionCodes.AUTHENTICATION_ERROR;parseErrorFromXMLDocument=function(b){if(b&&b.documentElement&&null!==b.documentElement.firstElementChild){var b=b.evaluate("//error",b.documentElement,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),f=b.snapshotLength;if(0===f)return!1;for(;0<f;)return b=b.snapshotItem(0),{code:b.getAttribute("code"),message:b.firstElementChild.getAttribute("message")}}return{code:null,message:"Unknown error: getSessionInfo XML response was badly formed"}};
onGetResponseCallback=function(b,f,a){b.logEvent("getSessionInfo","Success","api_url",OT.properties.apiURL);f(new OT.SessionInfo(a))};onGetErrorCallback=function(b,f,a){TB.handleJsException("TB.SessionInfoError :: Unable to get session info "+a.message,g[a.code],{session:b});b.logEvent("getSessionInfo","Failure","errorMessage","TB.SessionInfoError :: Unable to get session info "+a.message);f(a,b)};parseIceServersXml=function(b){for(var f=[],a,d,c=0,e=b.length;c<e;++c)"ice_server"===b[c].localName&&
(d=b[c].attributes,a={url:d.getNamedItem("url").nodeValue},d.getNamedItem("credential")&&d.getNamedItem("credential").nodeValue.length&&(a.credential=d.getNamedItem("credential").nodeValue),f.push(a));return f};normaliseIceServers=function(b){var f=navigator.userAgent.match(/(Firefox)\/([0-9]+\.[0-9]+)/),a=f?parseFloat(f[2],10):void 0,d;return b.map(function(b){if("turn:"!==b.url.trim().substr(0,5))return b;if(null!==f){if(25>a)return{url:b.url.replace("turn:","stun:")};27>a&&-1!==b.url.indexOf("?")&&
(b.url=b.url.trim().split("?")[0])}d=b.url.trim().split(/[:@]/);return{username:d[1],credential:b.credential,url:d[0]+":"+d[2]}})}})(window);(function(){OT.Capabilities=function(g){this.publish=-1!==g.indexOf("publish")?1:0;this.subscribe=-1!==g.indexOf("subscribe")?1:0;this.forceUnpublish=-1!==g.indexOf("forceunpublish")?1:0;this.forceDisconnect=-1!==g.indexOf("forcedisconnect")?1:0;this.supportsWebRTC=OT.$.supportsWebRTC()?1:0}})(window);
(function(){var g=function(b,f,a,d){var c,e={},g=function(){clearTimeout(c);b.off("exception",i)},i=function(a){e.hasOwnProperty(a.code)&&this.failed(e[a.code])};this.failsOnExceptionCodes=function(a){e=a};this.succeeded=function(){g();completionHandler&&OT.$.callAsync(completionHandler,null)};this.failed=function(a){g();completionHandler&&OT.$.callAsync(completionHandler,new OT.Error(null,a))};b.on("exception",i,this);c=setTimeout(function(){this.failed(d&&d.timeoutMessage?d.timeoutMessage:"Timed out while waiting for the server to respond.")}.bind(this),
3E4)};OT.Session=function(b){if(OT.checkSystemRequirements()){var f=!0,a,d,c,e=OT.$.uuid(),h=new OT.Analytics,i={},k={};OT.$.eventing(this);var j=OT.$.statable(this,["disconnected","connecting","connected","disconnecting"],"disconnected");this.connections=new OT.Collection;this.streams=new OT.Collection;var l=function(a,b){j("disconnected");OT.error(a);this.trigger("sessionConnectFailed",a);TB.handleJsException(a,b||OT.ExceptionCodes.CONNECT_FAILED,{session:this})},m=function(a){var b=a.reason;"networkTimedout"==
b?(b="networkDisconnected",this.logEvent("webSocketConnection","TimeOutDisconnect","reason",a.reason)):this.logEvent("webSocketConnection","Disconnected","reason",a.reason);var c=new OT.SessionDisconnectEvent("sessionDisconnected",b);s.call(this);x.call(this);a=function(){c.isDefaultPrevented()||v.call(this,c.reason)}.bind(this);this.dispatchEvent(c,a)},p=function(a){a.id.match(/^symphony\./)||this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_CREATED,[a]))},n=function(a,b){if(!a.id.match(/^symphony\./)&&
a.id!==c.id){if(i[a.id]){var d=i[a.id];delete i[a.id];"forceDisconnected"!==b&&OT.warn("Expected a forceDisconnect for connection "+a.id+", but a "+b+" was received instead.");d.succeeded()}this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_DESTROYED,[a],b))}},r=function(a){this.dispatchEvent(new OT.StreamEvent(OT.Event.names.STREAM_CREATED,[a]))},q=function(a){var b=a.target,c=a.changedProperty,d=a.newValue;"orientation"===c&&(c="videoDimensions",d={width:d.width,height:d.height});
this.dispatchEvent(new OT.StreamPropertyChangedEvent(OT.Event.names.STREAM_PROPERTY_CHANGED,b,c,a.oldValue,d))},o=function(a,b){if(k[a.id]){var c=k[a.id];delete k[a.id];"forceUnpublished"!==b&&OT.warn("Expected a forceUnpublish for stream "+a.id+", but a "+b+" destroyed was received instead.");c.succeeded()}var d=new OT.StreamEvent("streamDestroyed",[a],b),c=function(){if(!d.isDefaultPrevented()){var b=OT.publishers.where({streamId:a.id})[0];b&&(b._.unpublishFromSession(this),b.destroy());OT.subscribers.where({streamId:a.id}).forEach(function(a){a.session.id===
this.id&&this.unsubscribe(a)},this)}}.bind(this);this.dispatchEvent(d,c)},s=function(){d=a=null;j("disconnected");this.connections.destroy();this.streams.destroy()},x=function(){OT.publishers.where({session:this}).forEach(function(a){a.disconnect()});OT.subscribers.where({session:this}).forEach(function(a){a.disconnect()})},v=function(a){OT.publishers.where({session:this}).forEach(function(b){b.destroy(a)});OT.subscribers.where({session:this}).forEach(function(b){b.destroy(a)})},y=function(){TB.debug("OT.Session: connecting to Raptor");
c=new OT.Raptor.Socket(e,this.sessionInfo.messagingServer);c.connect(d,this.sessionInfo,function(a,b){a?l.call(this,a.reason,a.code):(OT.debug("OT.Session: Received session state from Raptor",b),j("connected"),this.connection.on("destroyed",m,this),this.connections.on({add:p,remove:n},this),this.streams.on({add:r,remove:o,update:q},this),this.dispatchEvent(new OT.SessionConnectEvent(OT.Event.names.SESSION_CONNECTED,b.connections,b.streams,b.archives)))}.bind(this))},B=function(){this.is("connecting")&&
OT.SessionInfo.get(this,z.bind(this),function(a){l.call(this,a.message+(a.code?" ("+a.code+")":""))}.bind(this))},z=function(b){this.is("connecting")&&(this.sessionInfo=b,this.sessionInfo.partnerId&&this.sessionInfo.partnerId!=a?(a=this.sessionInfo.partnerId,l.call(this,"Authentication Error: The apiKey passed into the session.connect method does not match the apiKey in the token or session you are trying to connect to.",OT.ExceptionCodes.AUTHENTICATION_ERROR)):y.call(this))};this.logEvent=function(c,
d,f,g){h.logEvent({action:c,variation:d,payload_type:f,payload:g,session_id:b,partner_id:a,widget_id:e,widget_type:"Controller"})};this.connect=function(b,c,g){this.is("connecting","connected")?OT.warn("OT.Session: Cannot connect, the session is already "+this.state):(s.call(this),j("connecting"),d=c,f?f=!1:e=OT.$.uuid(),a=b.toString(),0===OT.APIKEY.length&&(OT.APIKEY=a),g&&OT.$.isFunction(g)&&(this.once(OT.Event.names.SESSION_CONNECTED,g.bind(null,null)),this.once("sessionConnectFailed",g)),B.call(this))};
this.disconnect=function(){c&&c.isNot("disconnected")?(j("disconnecting"),c.disconnect()):s.call(this)};this.destroy=function(){this.streams.destroy();this.connections.destroy();this.disconnect()};this.publish=function(d,f,g){if(this.isNot("connected"))return h.logError(1010,"tb.exception","We need to be connected before you can publish",null,{action:"publish",variation:"Failure",payload_type:"reason",payload:"We need to be connected before you can publish",session_id:b,partner_id:a,widgetId:e,widget_type:"Controller"}),
g&&OT.$.isFunction(g)&&OT.$.callAsync(g,new OT.Error(OT.ExceptionCodes.NOT_CONNECTED,"We need to be connected before you can publish")),null;if(!c||!c.permittedTo("publish"))return this.logEvent("publish","Failure","reason","This token does not allow publishing. The role must be at least `publisher` to enable this functionality"),TB.handleJsException("This token does not allow publishing. The role must be at least `publisher` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_PUBLISH,{session:this}),
null;if(!d||"string"===typeof d||d.nodeType==Node.ELEMENT_NODE)d=OT.initPublisher(this.apiKey,d,f);else if(d instanceof OT.Publisher)"session"in d&&(d.session&&"sessionId"in d.session)&&(d.session.sessionId===this.sessionId?OT.warn("Cannot publish "+d.guid+" again to "+this.sessionId+". Please call session.unpublish(publisher) first."):OT.warn("Cannot publish "+d.guid+" publisher already attached to "+d.session.sessionId+". Please call session.unpublish(publisher) first."));else throw d="Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher",
OT.error(d),Error(d);if(g&&OT.$.isFunction(g))d.once("publishComplete",g);d._.publishToSession(this);return d};this.unpublish=function(a){a?a._.unpublishFromSession(this):OT.error("OT.Session.unpublish: publisher parameter missing.")};this.subscribe=function(a,b,c,d){if(!this.connection||!this.connection.connectionId)throw a="Session.subscribe :: Connection required to subscribe",OT.error(a),Error(a);if(!a)throw a="Session.subscribe :: stream cannot be null",OT.error(a),Error(a);if(!a.hasOwnProperty("streamId"))throw a=
"Session.subscribe :: invalid stream object",OT.error(a),Error(a);b=new OT.Subscriber(b,OT.$.extend(c||{},{session:this}));if(d&&OT.$.isFunction(d))b.once("subscribeComplete",d);OT.subscribers.add(b);b.subscribe(a);return b};this.unsubscribe=function(a){if(!a)throw OT.error("OT.Session.unsubscribe: subscriber cannot be null"),Error("OT.Session.unsubscribe: subscriber cannot be null");if(!a.stream)return OT.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream"),!1;OT.debug("OT.Session.unsubscribe: subscriber "+
a.id);a.destroy();return!0};this.getSubscribersForStream=function(a){return OT.subscribers.where({streamId:a.id})};this.getPublisherForStream=function(a){if("string"!=typeof a)if("object"==typeof a&&a&&a.hasOwnProperty("id"))a=a.id;else throw errorMsg="Session.getPublisherForStream :: Invalid stream type",OT.error(errorMsg),Error(errorMsg);return OT.publishers.where({streamId:a})[0]};this._={jsepSubscribe:function(a,b,d){return c.jsepSubscribe(a.connection.id,a.id,b,d)}.bind(this),jsepUnsubscribe:function(a){return c.jsepUnsubscribe(a.connection.id,
a.id)}.bind(this),jsepCandidate:function(a,b,d){return c.jsepCandidate(a,b.id,d)}.bind(this),jsepOffer:function(a,b,d){return c.jsepOffer(a,b.id,d)}.bind(this),jsepAnswer:function(a,b,d){return c.jsepAnswer(a,b.id,d)}.bind(this),dispatchSignal:function(a,b,c){a=new OT.SignalEvent(b,c,a);a.target=this;this.trigger(OT.Event.names.SIGNAL,a);b&&this.dispatchEvent(a)}.bind(this),modifySubscriber:function(a,b,d){return c.modifySubscriber(a,b,d)}.bind(this),createStream:function(a,b,d,e,f,g,h){c.createStream(a,
b,d,e,f,g,h)}.bind(this),modifyStream:function(a,b,d){!a||!b||void 0===d?OT.error("OT.Session.modifyStream: must provide streamId, key and value to modify a stream property."):c.updateStream(a,b,d)}.bind(this),destroyStream:function(a){c.destroyStream(a)}.bind(this)};this.signal=function(a,b){c.signal(a,b)};this.forceDisconnect=function(a,b){if(c&&c.permittedTo("forceDisconnect")){var d="string"===typeof a?a:a.id;if(b){var e=new g(this,b,{timeoutMessage:"Timed out while waiting for connection "+d+
" to be force Disconnected."});e.failsOnExceptionCodes({1520:"This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality"});i[d]=e}c.forceDisconnect(d)}else b&&OT.$.callAsync(b,new OT.Error(null,"This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality")),TB.handleJsException("This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,
{session:this})};this.forceUnpublish=function(a,b){if(c&&c.permittedTo("forceUnpublish")){var d="string"===typeof a?this.streams.get(a):a;if(b){var e=new g(this,b,{timeoutMessage:"Timed out while waiting for stream "+d.id+" to be force unpublished."});e.failsOnExceptionCodes({1530:"This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality"});k[d.id]=e}c.forceUnpublish(d.id)}else b&&OT.$.callAsync(b,new OT.Error(null,"This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality")),
TB.handleJsException("This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,{session:this})};this.getStateManager=function(){OT.warn("Fixme: Have not implemented session.getStateManager")};OT.$.defineGetters(this,{apiKey:function(){return a},token:function(){return d},connected:function(){return this.is("connected")},connection:function(){return c&&c.id?this.connections.get(c.id):null},capabilities:function(){return c?
c.capabilities:new OT.Capabilities([])},sessionId:function(){return b},id:function(){return b}},!0)}else OT.upgradeSystemRequirements()}})(window);(function(){var g=document.createElement("link");g.type="text/css";g.media="screen";g.rel="stylesheet";g.href=OT.properties.cssURL;(document.head||document.getElementsByTagName("head")[0]).appendChild(g)})(window);(function(){"function"===typeof define&&define.amd&&define("TB",[],function(){return TB})})(window);